<!DOCTYPE html>
<html>
  <head>
    <meta name="Content-Type" content="text/html;charset=UTF-8">
<meta charset="UTF-8">
<title> Plagiarism Detection Platform
 - Canvas LMS REST API Documentation</title>
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />
<link href="css/prettify.css" rel="stylesheet" type="text/css" media="screen" />
<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/prettify.js" type="text/javascript"></script>
<script type="text/javascript">
$(function() {
  // set up pretty-printing in static docs generated from .md files
  $('pre.code.bash').addClass('prettyprint language-bash');
  $('pre.code.html').addClass('prettyprint language-html');
  $('pre.code.xml').addClass('prettyprint language-xml');
  $('pre.code.json').addClass('prettyprint language-js');
  $('pre.code.javascript').addClass('prettyprint language-js');
  prettyPrint();
});
</script>

  </head>
  <body>

    <div id="header">
      <h1>
  <a href="index.html">Canvas LMS - REST API and Extensions Documentation</a>
</h1>
    </div>

    <div id="sidebar">
      <nav>
  <h2 class='first'>Basics</h2>
  <a href="file.graphql.html" class="">GraphQL</a>
  <a href="file.changelog.html" class="">API Change Log</a>
  <a href="file.object_ids.html" class="">SIS IDs</a>
  <a href="file.pagination.html" class="">Pagination</a>
  <a href="file.throttling.html" class="">Throttling</a>
  <a href="file.compound_documents.html" class="">Compound Documents</a>
  <a href="file.file_uploads.html" class="">File Uploads</a>
  <a href="file.endpoint_attributes.html" class="">API Endpoint Attributes</a>
  <a href="file.masquerading.html" class="">Masquerading</a>
  <h2>OAuth2</h2>
  <a href="file.oauth.html" class="">OAuth2 Overview</a>
  <a href="file.oauth_endpoints.html" class="">OAuth2 Endpoints</a>
  <a href="file.developer_keys.html" class="">Developer Keys</a>
  <h2>Resources</h2>
  <a  href="all_resources.html">All Resources Reference</a>
  
    
    <a class="" href="api_token_scopes.html">API Token Scopes</a>
  
    
    <a class="" href="account_notifications.html">Account Notifications</a>
  
    
    <a class="" href="account_reports.html">Account Reports</a>
  
    
    <a class="" href="accounts.html">Accounts</a>
  
    
    <a class="" href="accounts_(lti).html">Accounts (LTI)</a>
  
    
    <a class="" href="admins.html">Admins</a>
  
    
    <a class="" href="announcement_external_feeds.html">Announcement External Feeds</a>
  
    
    <a class="" href="announcements.html">Announcements</a>
  
    
    <a class="" href="appointment_groups.html">Appointment Groups</a>
  
    
    <a class="" href="assignment_extensions.html">Assignment Extensions</a>
  
    
    <a class="" href="assignment_groups.html">Assignment Groups</a>
  
    
    <a class="" href="assignments.html">Assignments</a>
  
    
    <a class="" href="authentication_providers.html">Authentication Providers</a>
  
    
    <a class="" href="authentications_log.html">Authentications Log</a>
  
    
    <a class="" href="blueprint_courses.html">Blueprint Courses</a>
  
    
    <a class="" href="bookmarks.html">Bookmarks</a>
  
    
    <a class="" href="brand_configs.html">Brand Configs</a>
  
    
    <a class="" href="calendar_events.html">Calendar Events</a>
  
    
    <a class="" href="collaborations.html">Collaborations</a>
  
    
    <a class="" href="comm_messages.html">CommMessages</a>
  
    
    <a class="" href="communication_channels.html">Communication Channels</a>
  
    
    <a class="" href="conferences.html">Conferences</a>
  
    
    <a class="" href="content_exports.html">Content Exports</a>
  
    
    <a class="" href="content_migrations.html">Content Migrations</a>
  
    
    <a class="" href="content_security_policy_settings.html">Content Security Policy Settings</a>
  
    
    <a class="" href="content_shares.html">Content Shares</a>
  
    
    <a class="" href="conversations.html">Conversations</a>
  
    
    <a class="" href="course_audit_log.html">Course Audit log</a>
  
    
    <a class="" href="course_quiz_extensions.html">Course Quiz Extensions</a>
  
    
    <a class="" href="courses.html">Courses</a>
  
    
    <a class="" href="custom_gradebook_columns.html">Custom Gradebook Columns</a>
  
    
    <a class="" href="discussion_topics.html">Discussion Topics</a>
  
    
    <a class="" href="enrollment_terms.html">Enrollment Terms</a>
  
    
    <a class="" href="enrollments.html">Enrollments</a>
  
    
    <a class="" href="error_reports.html">Error Reports</a>
  
    
    <a class="" href="external_tools.html">External Tools</a>
  
    
    <a class="" href="favorites.html">Favorites</a>
  
    
    <a class="" href="feature_flags.html">Feature Flags</a>
  
    
    <a class="" href="files.html">Files</a>
  
    
    <a class="" href="grade_change_log.html">Grade Change Log</a>
  
    
    <a class="" href="gradebook_history.html">Gradebook History</a>
  
    
    <a class="" href="grading_periods.html">Grading Periods</a>
  
    
    <a class="" href="grading_standards.html">Grading Standards</a>
  
    
    <a class="" href="group_categories.html">Group Categories</a>
  
    
    <a class="" href="groups.html">Groups</a>
  
    
    <a class="" href="history.html">History</a>
  
    
    <a class="" href="image_search.html">Image Search</a>
  
    
    <a class="" href="immersive_reader.html">Immersive Reader</a>
  
    
    <a class="" href="inst_access_tokens.html">InstAccess tokens</a>
  
    
    <a class="" href="jw_ts.html">JWTs</a>
  
    
    <a class="" href="late_policy.html">Late Policy</a>
  
    
    <a class="" href="line_items.html">Line Items</a>
  
    
    <a class="" href="live_assessments.html">LiveAssessments</a>
  
    
    <a class="" href="logins.html">Logins</a>
  
    
    <a class="" href="media_objects.html">Media Objects</a>
  
    
    <a class="" href="moderated_grading.html">Moderated Grading</a>
  
    
    <a class="" href="modules.html">Modules</a>
  
    
    <a class="" href="names_and_role.html">Names and Role</a>
  
    
    <a class="" href="notification_preferences.html">Notification Preferences</a>
  
    
    <a class="" href="originality_reports.html">Originality Reports</a>
  
    
    <a class="" href="outcome_groups.html">Outcome Groups</a>
  
    
    <a class="" href="outcome_imports.html">Outcome Imports</a>
  
    
    <a class="" href="outcome_results.html">Outcome Results</a>
  
    
    <a class="" href="outcomes.html">Outcomes</a>
  
    
    <a class="" href="pages.html">Pages</a>
  
    
    <a class="" href="peer_reviews.html">Peer Reviews</a>
  
    
    
    
    
    <a class="" href="planner.html">Planner</a>
  
    
    <a class="" href="poll_sessions.html">Poll Sessions</a>
  
    
    <a class="" href="poll_choices.html">PollChoices</a>
  
    
    <a class="" href="poll_submissions.html">PollSubmissions</a>
  
    
    <a class="" href="polls.html">Polls</a>
  
    
    <a class="" href="proficiency_ratings.html">Proficiency Ratings</a>
  
    
    <a class="" href="progress.html">Progress</a>
  
    
    <a class="" href="public_jwk.html">Public JWK</a>
  
    
    <a class="" href="quiz_assignment_overrides.html">Quiz Assignment Overrides</a>
  
    
    <a class="" href="quiz_extensions.html">Quiz Extensions</a>
  
    
    <a class="" href="quiz_ip_filters.html">Quiz IP Filters</a>
  
    
    <a class="" href="quiz_question_groups.html">Quiz Question Groups</a>
  
    
    <a class="" href="quiz_questions.html">Quiz Questions</a>
  
    
    <a class="" href="quiz_reports.html">Quiz Reports</a>
  
    
    <a class="" href="quiz_statistics.html">Quiz Statistics</a>
  
    
    <a class="" href="quiz_submission_events.html">Quiz Submission Events</a>
  
    
    <a class="" href="quiz_submission_files.html">Quiz Submission Files</a>
  
    
    <a class="" href="quiz_submission_questions.html">Quiz Submission Questions</a>
  
    
    <a class="" href="quiz_submission_user_list.html">Quiz Submission User List</a>
  
    
    <a class="" href="quiz_submissions.html">Quiz Submissions</a>
  
    
    <a class="" href="quizzes.html">Quizzes</a>
  
    
    <a class="" href="result.html">Result</a>
  
    
    <a class="" href="roles.html">Roles</a>
  
    
    <a class="" href="rubrics.html">Rubrics</a>
  
    
    <a class="" href="sis_import_errors.html">SIS Import Errors</a>
  
    
    <a class="" href="sis_imports.html">SIS Imports</a>
  
    
    <a class="" href="sis_integration.html">SIS Integration</a>
  
    
    <a class="" href="score.html">Score</a>
  
    
    <a class="" href="search.html">Search</a>
  
    
    <a class="" href="sections.html">Sections</a>
  
    
    <a class="" href="services.html">Services</a>
  
    
    <a class="" href="shared_brand_configs.html">Shared Brand Configs</a>
  
    
    <a class="" href="submission_comments.html">Submission Comments</a>
  
    
    <a class="" href="submissions.html">Submissions</a>
  
    
    <a class="" href="tabs.html">Tabs</a>
  
    
    <a class="" href="user_observees.html">User Observees</a>
  
    
    <a class="" href="users.html">Users</a>
  
    
    
    <a class="" href="e_pub_exports.html">ePub Exports</a>
  
  <h2>Outcomes</h2>
  <a href="file.outcomes_csv.html" class="">Outcomes CSV Format</a>
  <h2>Group Categories</h2>
  <a href="file.group_category_csv.html" class="">Group Categories CSV Format</a>
  <h2>SIS</h2>
  <a href="file.sis_csv.html" class="">SIS CSV Format</a>
  <h2>External Tools</h2>
  <td>
    <li><h4>LTI</h4>
      <a href="file.tools_intro.html" class="">Introduction</a>
      <a href="file.lti_dev_key_config.html" class="">Configuring</a>
      <a href="file.tools_variable_substitutions.html" class="">Variable Substitutions</a>
      <a href="file.content_item.html" class="">Deep Linking</a>
      <a href="file.assignment_tools.html" class="">Grading</a>
      <a href="file.provisioning.html" class="">Provisioning</a>
      <a href="file.lti_window_post_message.html" class="">window.PostMessage</a>
        <ul><h4>Placements</h4>
                <a href="file.navigation_tools.html" class="">Navigation</a>
                <a href="file.homework_submission_placement.html" class="">Homework Submission</a>
                <a href="file.editor_button_placement.html" class="">Editor Button</a>
                <a href="file.migration_selection_placement.html" class="">Migration Selection</a>
                <a href="file.link_selection_placement.html" class="">Link Selection (Modules)</a>
                <a href="file.assignment_selection_placement.html" class="">Assignment Selection</a>
                <a href="file.collaborations_placement.html" class="">Collaborations</a>
        </ul >
      <a href="file.xapi.html" class="">xAPI</a>
    </li >
    <li><h4>Plagiarism Detection Platform</h4>
      <a href="" class="current">Overview</a>
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a class="" href="plagiarism_detection_platform_assignments.html">Plagiarism Detection Platform Assignments</a>
      
        
        <a class="" href="plagiarism_detection_platform_users.html">Plagiarism Detection Platform Users</a>
      
        
        <a class="" href="plagiarism_detection_submissions.html">Plagiarism Detection Submissions</a>
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a class="" href="webhooks_subscriptions_for_plagiarism_platform.html">Webhooks Subscriptions for Plagiarism Platform</a>
      
        
      <a href="file.jwt_access_tokens.html" class="">JWT Access Tokens</a>
    </li >
  </td>
  <h2>Data Services</h2>
  <td>
    <li>
      <h4>Live Events</h4>
      <ul>
        <h4>Overview</h4>
        <a href="file.data_service_introduction.html" class="">Introduction</a>
        <a href="file.data_service_setup.html" class="">Setup</a>
        <a href="file.data_service_canvas_event_metadata.html" class="">Metadata</a>
      </ul>

      <ul>
        <h4>Event Format</h4>
        <li>
          <h4>Canvas</h4>
          
            <a href="file.data_service_canvas_account.html" class="">Account</a>
          
            <a href="file.data_service_canvas_asset.html" class="">Asset</a>
          
            <a href="file.data_service_canvas_assignment.html" class="">Assignment</a>
          
            <a href="file.data_service_canvas_attachment.html" class="">Attachment</a>
          
            <a href="file.data_service_canvas_content.html" class="">Content</a>
          
            <a href="file.data_service_canvas_conversation.html" class="">Conversation</a>
          
            <a href="file.data_service_canvas_course.html" class="">Course</a>
          
            <a href="file.data_service_canvas_discussion.html" class="">Discussion</a>
          
            <a href="file.data_service_canvas_enrollment.html" class="">Enrollment</a>
          
            <a href="file.data_service_canvas_grade.html" class="">Grade</a>
          
            <a href="file.data_service_canvas_group.html" class="">Group</a>
          
            <a href="file.data_service_canvas_learning.html" class="">Learning</a>
          
            <a href="file.data_service_canvas_logged.html" class="">Logged</a>
          
            <a href="file.data_service_canvas_module.html" class="">Module</a>
          
            <a href="file.data_service_canvas_outcome.html" class="">Outcome</a>
          
            <a href="file.data_service_canvas_plagiarism.html" class="">Plagiarism</a>
          
            <a href="file.data_service_canvas_quiz.html" class="">Quiz</a>
          
            <a href="file.data_service_canvas_sis.html" class="">Sis</a>
          
            <a href="file.data_service_canvas_submission.html" class="">Submission</a>
          
            <a href="file.data_service_canvas_syllabus.html" class="">Syllabus</a>
          
            <a href="file.data_service_canvas_user.html" class="">User</a>
          
            <a href="file.data_service_canvas_wiki.html" class="">Wiki</a>
          
        </li>
        <li>
          <h4>Caliper IMS 1.1</h4>
          
            <a href="file.data_service_caliper_assessment.html" class="">Assessment</a>
          
            <a href="file.data_service_caliper_basic.html" class="">Basic</a>
          
            <a href="file.data_service_caliper_forum.html" class="">Forum</a>
          
            <a href="file.data_service_caliper_grading.html" class="">Grading</a>
          
            <a href="file.data_service_caliper_navigation_events.html" class="">Navigation Events</a>
          
            <a href="file.data_service_caliper_session.html" class="">Session</a>
          
        </li>
      </ul>
    </li>
  </td>
</nav>

    </div>

    <div id="content"><div id='filecontents'><h1 id="plagiarism-detection-platform"> Plagiarism Detection Platform</h1>

<p>The plagiarism detection platform provides a standard way for LTI2 tool providers (TPs) to seamlessly integrate plagiarism detection tools with Canvas. Part of this platform is the introduction of Originality Reports which can be created, edited, and retrieved by TPs. TPs are also given a means of subscribing to webhooks to notify them of changes to assignments and submissions.</p>

<p>This document provides details to guide TPs toward leveraging the plagiarism detection platform. The document is divided into three sections that cover the plagiarism detection platform:</p>

<h4 id="section-1-tool-registration-webhooks">Section 1 - Tool Registration &amp; Webhooks</h4>

<p>TPs leveraging the new plagiarism detection platform must go through the standard LTI2 registration flow, with some additional steps along the way.  Canvas will automatically create a subscription on behalf of the tool for a submissions webhook, allowing the TP to be notified when a submission has been made. (See <a href="webhooks_subscriptions_for_plagiarism_platform.html">Webhooks Subscriptions for Plagiarism Platform</a>.)</p>

<h4 id="section-2-tool-launch">Section 2 - Tool Launch</h4>

<p>Once registered, tools will be provided with an LTI tool placement in the Canvas assignment create/edit UI to launch a configuration page.</p>

<h4 id="section-3-originality-reports">Section 3 - Originality Reports</h4>

<p>The webhook sent to the TP contains the data needed for the tool to retrieve the submission from Canvas. The TP can then process the submission, determine its &quot;originality score&quot;, and create an Originality Report. This data is then sent back to Canvas and associated with the submission via the Canvas Originality Report API.</p>

<h4 id="section-4-other-features">Section 4 - Other Features</h4>

<p>Descriptions of optional features tool providers may use.</p>

<p>For additional help please see the following reference tools:</p>

<ul>
<li><a href="https://github.com/instructure/lti_originality_report_example">Plagiarism Detection Reference Tool</a></li>
<li><a href="https://github.com/instructure/lti2_reference_tool_provider">LTI 2.1 Reference Tool</a></li>
</ul>

<h3 id="1-tool-registration">1. Tool Registration</h3>

<p>Canvas’ plagiarism platform requires the TP to support LTI2 and obtain a Canvas developer key. During the standard LTI2 registration flow, the TP should take the following steps:</p>

<ol>
<li>Include a JWT access token in the Authorization header of the request to get the Tool Consumer Profile (see section 1.1).

<ol>
<li>Add the <code>Canvas.placements.similarityDetection</code> capability to the Tool Profile’s Resource Handler enabled capabilities (See section 1.2).</li>
</ol></li>
<li>Add the <code>vnd.Canvas.OriginalityReport</code> service to the Tool Proxy’s Security Contract (see section 1.3).</li>
<li>Add the <code>Security.splitSecret</code> capability to the Tool Proxy’s enabled capabilities (see section 1.4).</li>
<li>Include a JWT access token in the Authorization header of the Tool Proxy create POST request (see section 1.5).</li>
</ol>

<h4 id="1-1-include-jwt-access-token-in-tool-consumer-profile-request">1.1 Include JWT Access Token in Tool Consumer Profile Request</h4>

<p>Requesting a TCP is the second step of registering an LTI2 Tool (See <a href="https://www.imsglobal.org/specs/ltiv2p0/implementation-guide#toc-100">LTI2 implementation guide</a>)</p>

<p>Canvas will include a restricted set of services/capabilities in the TCP if the request to retrieve the TCP contains a JWT access token in the Authorization header.</p>

<p>Canvas requires that the TP use the following restricted capabilities/services:</p>

<ul>
<li><code>vnd.Canvas.OriginalityReport</code> service</li>
<li><code>vnd.Canvas.submission</code> service</li>
<li><code>Canvas.placements.similarityDetection</code> capability</li>
</ul>

<p>To retrieve a TCP with these restricted services/capabilities first retrieve a JWT access token as described in <a href="jwt_access_tokens.html">JWT access tokens</a> section 1.0. These tokens are associated with a single developer key which, in turn, are associated with a single custom TCP. Include this token in the authorization header of the request to retrieve the TCP:</p>

<pre class="code"><code class="">Authorization Bearer &lt;JWT access token&gt;
</code></pre>

<h4 id="1-2-adding-the-similarity-detection-placement">1.2 Adding the Similarity Detection Placement</h4>

<p>Tool Providers who wish to use the plagiarism detection platform must add the similarity detection placement capability to the Tool Profile’s Resource Handler:</p>

<pre class="code json"><code class="json">{
…
&quot;resource_handler&quot;:[
      {
         …
         &quot;message&quot;:[
            {
               &quot;message_type&quot;:&quot;basic-lti-launch-request&quot;,
               &quot;path&quot;:&quot;/messages/assignment-configuration&quot;,
               &quot;enabled_capability&quot;: [&quot;Canvas.placements.similarityDetection&quot;]
            }
         ]
      }
  ]
…
}
</code></pre>

<p>This placement is listed in the TCP request as described in section 1.1:</p>

<pre class="code json"><code class="json">{
…
&quot;capability_offered&quot;:[
      &quot;basic-lti-launch-request&quot;,
      &quot;User.id&quot;,
    …
      &quot;Canvas.placements.similarityDetection&quot;
   ],
…
}
</code></pre>

<p>Note that the <code>Canvas.placements.similarityDetection</code> capability should be enabled in both the resource handler and in the <code>enabled_capability</code> array at the root of the tool proxy.</p>

<h4 id="1-3-adding-the-services-to-the-security-contract">1.3 Adding the Services to the Security Contract</h4>

<p>The following example security contract shows the services required to use the plagiarism platform:</p>

<pre class="code json"><code class="json">{
  …
  &quot;security_contract&quot;: {
    …
    &quot;tool_service&quot;: [{
      &quot;@type&quot;: &quot;RestService&quot;,
      &quot;service&quot;: &quot;http://canvas.docker/api/lti/courses/3/tool_consumer_profile/339b6700-e4cb-47c5-a54f-3ee0064921a9#vnd.Canvas.OriginalityReport&quot;,
      &quot;action&quot;: [&quot;POST&quot;, &quot;PUT&quot;, &quot;GET&quot;]
    },
    {
      &quot;@type&quot;: &quot;RestService&quot;,
      &quot;service&quot;: &quot;http://canvas.docker/api/lti/courses/3/tool_consumer_profile/339b6700-e4cb-47c5-a54f-3ee0064921a9#vnd.Canvas.submission&quot;,
      &quot;action&quot;: [&quot;GET&quot;]
    },
    {
      &quot;service&quot;: &quot;http://canvas.docker/api/lti/courses/3/tool_consumer_profile/339b6700-e4cb-47c5-a54f-3ee0064921a9#vnd.Canvas.submission.history&quot;,
      &quot;action&quot;: [&quot;GET&quot;]
    }]
  …
}
</code></pre>

<p>For each tool service object, the <code>service</code> field must match the <code>@id</code> of the <code>service</code> given in the TCP (see section 1.1) and the value of <code>action</code> must be a subset of the actions provided in the TCP (see section 1.1).</p>

<h4 id="1-4-adding-the-security-splitsecret-capability">1.4 Adding the Security.splitSecret Capability</h4>

<p>The <code>Security.splitSecret</code> capability must be used by the TP when using the similarity detection platform in Canvas. Specify this capability in the Tool Proxy:</p>

<pre class="code json"><code class="json">{
  …
  &quot;lti_version&quot;: &quot;LTI-2p0&quot;,
  &quot;tool_profile&quot; : {…}.
  &quot;enabled_capability&quot;: [&quot;Canvas.placements.similarityDetection&quot;, &quot;Security.splitSecret&quot;]
  …
}
</code></pre>

<p>The following excerpt regarding the split secret capability is from the LTI 2.1 Implementation Guide (in draft) and may change in the future:</p>

<blockquote>
<p>The shared secret is used to digitally sign launch requests in accordance with the OAuth [sic]. If the Tool Consumer offers a capability of <code>Security.splitSecret</code> and this is enabled in the Tool Proxy, then the security contract should include an element named <code>tp_half_shared_secret</code> with a value of 128 hexadecimal characters (all in lowercase). This represents the second half of the string to use as the shared secret; the first half will be generated by the Tool Consumer and passed to the Tool Provider in its acceptance response (see section 10.1) as a parameter named <code>tc_half_shared_secret</code> (along with the Tool Proxy GUID value); this should also be a 128 string of lowercase hexadecimal characters. Each 128-character hexadecimal string should be generated from 64 bytes of random data. If the split secret capability was not offered or enabled, then the security contract should include the full shared secret in an element named <code>shared_secret</code>. The Tool Proxy should never contain both the <code>tp_half_shared_secret</code> and <code>shared_secret</code> elements; just one or the other.</p>
</blockquote>

<h4 id="1-5-the-tool-proxy-create-request-webhooks">1.5 The Tool Proxy Create Request &amp; Webhooks</h4>

<p>The next-to-last step in the standard LTI2 registration flow is creating a Tool Proxy in the Tool Consumer (see <a href="https://www.imsglobal.org/specs/ltiv2p0/implementation-guide#toc-101">LTI2 implementation guide</a>).</p>

<p>To register a Tool Proxy that uses restricted capabilities/services (like the originality report service) from a custom TCP the Tool Proxy creation <code>POST</code> request should include a JWT access token in the <code>Authorization</code> header. For information on retrieving a JWT access token for this purpose see <a href="jwt_access_tokens.html">JWT access tokens</a> section 1.0. This may be the same token used to retrieve the tool consumer profile.</p>

<p>Standard LTI2 registration requires requests to be signed with a temporary <code>reg_key</code> and <code>reg_password</code> (see <a href="https://www.imsglobal.org/specs/ltiv2p0/implementation-guide#toc-60">LTI@ implementation guide</a>). When using a JWT access token in the authorization header this is not necessary (see <a href="jwt_access_tokens.html">JWT access tokens</a> section 1.0).</p>

<p>Once a Tool Proxy is created Canvas will automatically create a subscription to notify the tool when submissions are created by students(see section 2.2).</p>

<h3 id="2-tool-launch">2. Tool Launch</h3>

<p>Tools configured as described in section 1 of this document will be launchable from the assignment create/edit page in Canvas (see section 2.1).</p>

<h4 id="2-1-the-similarity-detection-placement">2.1 The Similarity Detection Placement</h4>

<p>Tools configured as described in section 1 of this document will be made available to assignments using “File Upload” submission types. Other submission types are not supported at this time. Once “File Upload” submission type is selected, a “Plagiarism Review” dropdown box becomes available so that the user can associate the assignment to the plagiarism tool. Note that the plagiarism platform feature flag must be enabled in Canvas.</p>

<p>Selecting a tool in the &quot;Plagiarism Review&quot; selector initiates a standard LTI launch to the launch URL provided in the resource handler during the registration phase (see 1.2). This launch is intended to allow configuration of the plagiarism review tool during the assignment creation process.</p>

<p>~~In addition to standard LTI parameters and variables requested by the TP for this launch, Canvas will send a parameter named <code>ext_lti_assignment_id</code>.~~ This behavior will soon be deprecated. Instead please add the <code>com.instructure.Assignment.lti.id</code> capability to the same message that uses the <code>Canvas.placements.similarityDetection</code> capability. This parameter&#39;s value uniquely identifies the assignment and may be used by the TP to show the correct configuration options.</p>

<h4 id="2-2-webhook-background">2.2 Webhook Background</h4>

<p>Webhooks from canvas are your way to know that a change has taken place (e.g. new or updated submission, change to assignment, etc).</p>

<p>Webhooks are available via HTTPS to an endpoint you own and specify, or via an AWS SQS queue that you provision, own, and specify. We recommend SQS for the most robust integration, but do support HTTPS for lower volume applications.</p>

<p>Webhooks that are sent but receive an unsuccessful response will be retried five times, waiting thirty seconds between attempts.</p>

<p>If you choose to use SQS transport, contact us for simple steps on how to grant Canvas write permissions to your queue or queues.</p>

<p>We do not duplicate or batch messages before transmission. Avoid creating multiple identical subscriptions. Webhooks always identify the ID of the subscription that caused them to be sent, allowing you to identify problematic or high volume subscriptions.</p>

<p>We cannot guarantee the transmission order of webhooks. If order is important to your application, you must check the “event_time” attribute in the “metadata” hash to determine the sequence that events occurred in Canvas.</p>

<p>While we strive to maintain very low latency, this is not guaranteed at all times, and applications should support delays of several minutes.</p>

<p>Additional JSON keys may be added in the future. Consumers should be permissive in what they accept in this regard.</p>

<h4 id="2-3-subscribing-to-webhooks">2.3 Subscribing to Webhooks</h4>

<p>Once a Tool Proxy is created that enables a plagiarism detection tool, a webhook subscription is automatically created and configured as specified by the <code>SubmissionEvent</code> service in the Tool Profile’s <code>service_offered</code> section. Below is an example of how to configure this service in the Tool Profile:</p>

<pre class="code json"><code class="json">{
  …
  &quot;service_offered&quot;: [{
    // Must end in &quot;#vnd.Canvas.SubmissionEvent&quot;
    &quot;@id&quot;: &quot;my.tool.com/service#vnd.Canvas.SubmissionEvent&quot;,
    &quot;endpoint&quot;: &quot;http://my.tool.com/subission_endpoint&quot;,// Endpoint Canvas will POST events to
    &quot;@type&quot;: &quot;RestService&quot;,
    &quot;format&quot;: [&quot;application/json&quot;],
    &quot;action&quot;: [&quot;POST&quot;]
  }],
  …
}
</code></pre>

<p>This automatic subscription will cause a webhook to be sent to the endpoint specified by the SubmissionEvent whenever a submission is created or updated or when a user clicks the “resubmit to plagiarism detection service” button in the Canvas UI.</p>

<h4 id="2-4-webhook-payload-format">2.4 Webhook payload format</h4>

<p>HTTPS Webhooks will be transmitted over HTTPS via a POST request with a content type of application/json to the endpoint you specify in your subscriptions.</p>

<p>SQS Webhooks will contain the same JSON body as the body of the SQS Message.</p>

<p>For additional field definitions and example JSON payloads, see the documentation for assignment_updated, submission_created, and submission_updated event types in the Canvas Data Services LTI Tool, or on S3 here: <a href="https://d1raj86qipxohr.cloudfront.net/production/canvas/event-types/assignment_updated.json">assignment_updated</a>, <a href="https://d1raj86qipxohr.cloudfront.net/production/canvas/event-types/submission_created.json">submission_created</a>, <a href="https://d1raj86qipxohr.cloudfront.net/production/canvas/event-types/submission_updated.json">submission_updated</a></p>

<h3 id="3-originality-reports">3. Originality Reports</h3>

<p>Once the TP has been notified of a new submission (see section 2.2), it may access the submission through the <a href="plagiarism_detection_submissions.html">Canvas LTI Submissions API</a> for processing. The payload from this request will contain URLs for retrieving the submission’s attachment.</p>

<p>After processing the submission, an Originality Report may be created for the submission.</p>

<p>For more details on creating originality reports see the <a href="originality_reports.html"> Canvas Originality Report API documentation</a>.</p>

<p>Using the Originality Report and Submissions APIs requires a JWT access token be sent in the authorization header. For more information on using JWT tokens in Canvas see <a href="jwt_access_tokens.html">JWT access tokens</a>.</p>

<h3 id="4-other-features-and-considerations">4. Other Features and Considerations</h3>

<p>The following are optional features the tool provider may wish to implement.</p>

<h4 id="course-copy">Course Copy</h4>

<p>The plagiarism platform automatically handles most of the work required for course copy to work with TPs. When a Course that contains assignments associated with a plagiarism detection TP is copied in Canvas the following occurs:</p>

<ul>
<li>The copies of assignments in the new course are automatically associated with the correct tool.</li>
<li>Tool Settings associated with the course are copied to the new course (See <em>Using the LTI Tool Settings Service</em> below).</li>
</ul>

<p>These two actions will only occur if the same TP has been installed in the context the course is being copied to.</p>

<p>Once the course copy has occurred TPs should be aware that they will begin receiving <code>submission_created</code> webhooks for assignments for which they have never had an LTI launch occur. This is because it is unlikely that an instructor will edit each assignment in the new course, which is what would allow the <code>Canvas.placements.similarityDetection</code> placement LTI launch to occur. To access information about assignments that a TP has never received an LTI launch for use the <a href="plagiarism_detection_platform_assignments.html">Assignment LTI API</a>.</p>

<p>TPs often have a configuration that is set on a per-assignment basis via their UI by the instructor creating the assignment and stored by the TP. There are two ways of handeling these TP configurations during a course copy: using reasonable defaults or using the LTI Tool Settings Service.</p>

<h5 id="option-1-using-defaults">Option 1: Using Defaults</h5>

<p>When receiving a <code>submission_created</code> webhook for an assignment that has never had an associated LTI launch, TP configuration items have not been set by the instructor. In these cases, TPs should use good defaults for any custom configuration they typically offer to instructors when configuring assignments. TPs may even wish to provide a resource handler that uses the <code>Canvas.placements.accountNavigation</code> placement in order to provide Canvas administrators the ability to set account-level default configurations.</p>

<h5 id="option-2-using-the-lti-tool-settings-service">Option 2: Using the LTI Tool Settings Service</h5>

<p>The LTI Tool Settings service may be used as a key/value store associated with a particular LTI launch. This means that a TP may store their custom per-assignment configuration in a Tool Setting associated with the Canvas assignment. When a course is copied all Tool Settings will be copied to the new course and be associated with the proper assignments in the new context. The following describes how to create a Tool Setting associated with an assignment and leverage it for course copy:</p>

<ol>
<li>Use <code>LtiLink.custom.url</code> variable expansion</li>
<li>Store assignment-level custom configuration in Tool Settings</li>
<li>When receiving a <code>submission_created</code> webhook for an unknown assignment, use the LTI assignment API to fetch assignment data</li>
<li>When receiving a <code>submission_created</code> webhook for an unknown assignment, use the <code>lti_assignment_id</code> and the Tool Setting Service to retrieve TP assignment-level configuration</li>
</ol>

<h5 id="1-using-ltilink-custom-url">1. Using <code>LtiLink.custom.url</code></h5>

<p>The <code>LtiLink.custom.url</code> variable expansion should be used in the same message handler that handles <code>Canvas.placements.similarityDetection</code> launches:</p>

<pre class="code json"><code class="json">...
&quot;message&quot;:[
    {
       &quot;message_type&quot;:&quot;basic-lti-launch-request&quot;,
       &quot;path&quot;:&quot;/messages/assignment-configuration&quot;,
       &quot;enabled_capability&quot;: [&quot;Canvas.placements.similarityDetection&quot;],
       &quot;parameter&quot;: [
          {
            &quot;name&quot;: &quot;tool_setting_endpoint&quot;,
            &quot;variable&quot;: &quot;LtiLink.custom.url&quot;
          }
       ]
    }
]
...
</code></pre>

<p>Canvas will then create a Tool Setting for the TP associated with the assignment when the <code>Canvas.placements.similarityDetection</code> launch occurs for the first time. This Tool Setting can be used to store TP specific assignment-level configuration that will be copied to the new context during a course copy.</p>

<h5 id="2-store-assignment-level-custom-configuration-in-tool-settings">2. Store assignment-level custom configuration in Tool Settings</h5>

<pre class="code"><code class="">PUT
/api/lti/tool_proxy/&lt;tool proxy guid&gt;/courses/24/resource_link_id/&lt;lti assignment id&gt;/tool_setting
</code></pre>

<p>Example Request:</p>

<pre class="code"><code class="">curl -X PUT \
  http://canvas.docker/api/lti/tool_proxy/0ce4dbf1-b8c5-407d-85ac-618d7615a5a5/courses/24/resource_link_id/b2d9b916-5128-42ad-ad17-b54091a52be2/tool_setting \
  -H &#39;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJDYW52YXMiLCJzdWIiOiIwY2U0ZGJmMS1iOGM1LTQwN2QtODVhYy02MThkNzYxNWE1YTUiLCJleHAiOjE1MTI3NTYwOTMsImF1ZCI6WyJjYW52YXMuZG9ja2VyIiwiY2FudmFzLmRvY2tlciJdLCJpYXQiOjE1MTI3NTI0OTMsIm5iZiI6MTUxMjc1MjQ2MywianRpIjoiZTY3MmM5OGItYmM4NS00NjliLWE5YjYtNjEyMDE2MWFhZjk0Iiwic2hhcmRfaWQiOjEsInJlZ19rZXkiOiIwY2U0ZGJmMS1iOGM1LTQwN2QtODVhYy02MThkNzYxNWE1YTUifQ.InMhzWYLhcAWRJHJsy9pRojEcQ5KRUtRGp50mQmFrnA&#39; \
  -H &#39;Cache-Control: no-cache&#39; \
  -H &#39;Content-Type: application/x-www-form-urlencoded&#39; \
</code></pre>

<p>When using the update endpoint the request body should contain JSON defining the key/value pairs the TP wishes Canvas to store in the Tool Setting. Canvas will <em>replace</em> the contents of the Tool Setting with whatever keys/values are sent in the request:</p>

<pre class="code json"><code class="json">{&quot;tp_custom_setting&quot;: &quot;some value&quot;}
</code></pre>

<p>This endpoint is defined in the tool consumer profile.</p>

<h5 id="3-use-the-lti-assignment-api-to-fetch-assignment-data">3. use the LTI assignment API to fetch assignment data</h5>

<p>When a <code>submission_created</code> webhook is received for an assignment the TP has not seen before, it means that the submission is for an assignment that was copied from an assignment the TP <em>was</em> configured on within another course. The TP should still process the submission. To fetch assignment information for a submission that has not been seen before, use the <a href="plagiarism_detection_platform_assignments.html">Canvas LTI Assignments API</a></p>

<h5 id="4-use-the-lti_assignment_id-and-the-tool-setting-service-to-retrieve-tp-assignment-level-configuration">4. use the <code>lti_assignment_id</code> and the Tool Setting Service to retrieve TP assignment-level configuration</h5>

<p>If the TP has been leveraging Tool Settings in Canvas to store TP specific assignment-level configurations, those Tool Settings will be copied to the new assignment as well. To access the Tool Setting note the <code>lti_assignment_id</code> in the <code>submission_created</code> webhook. The Tool Setting that should be requested will have a <code>resource_link_id</code> that matches this value:</p>

<pre class="code"><code class="">GET
/api/lti/tool_proxy/&lt;tool proxy guid&gt;/courses/24/resource_link_id/&lt;lti assignment id&gt;/tool_setting

</code></pre>

<p>Example Request:</p>

<pre class="code"><code class="">curl -X GET \
  http://canvas.docker/api/lti/tool_proxy/0ce4dbf1-b8c5-407d-85ac-618d7615a5a5/courses/24/resource_link_id/b2d9b916-5128-42ad-ad17-b54091a52be2/tool_setting \
  -H &#39;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJDYW52YXMiLCJzdWIiOiIwY2U0ZGJmMS1iOGM1LTQwN2QtODVhYy02MThkNzYxNWE1YTUiLCJleHAiOjE1MTI3NTYwOTMsImF1ZCI6WyJjYW52YXMuZG9ja2VyIiwiY2FudmFzLmRvY2tlciJdLCJpYXQiOjE1MTI3NTI0OTMsIm5iZiI6MTUxMjc1MjQ2MywianRpIjoiZTY3MmM5OGItYmM4NS00NjliLWE5YjYtNjEyMDE2MWFhZjk0Iiwic2hhcmRfaWQiOjEsInJlZ19rZXkiOiIwY2U0ZGJmMS1iOGM1LTQwN2QtODVhYy02MThkNzYxNWE1YTUifQ.InMhzWYLhcAWRJHJsy9pRojEcQ5KRUtRGp50mQmFrnA&#39; \
  -H &#39;Cache-Control: no-cache&#39; \
  -H &#39;Content-Type: application/x-www-form-urlencoded&#39;
</code></pre>

<p>Response:</p>

<pre class="code"><code class=""><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tp_custom_setting</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some value</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
</code></pre>

<h4 id="group-assignments">Group Assignments</h4>

<p>When a student submits to a group assignment, Canvas will send a <code>submission_created</code> webhook for <em>each student in that group</em>. The tool provider need only respond to one of these webhooks per group.</p>

<p>Canvas will copy any originality reports created for a group submission to every other student in the same group. Canvas will also propagate edits to any originality reports for a group submission to every other student in the same group.</p>

<p>The <code>submission_created</code> and <code>subission_updated</code> webhooks each contain a <code>group_id</code> that identifies what group a submission belongs to. Tool providers may use this value to make sure they only create one originality report per group.</p>

<h4 id="end-user-license-agreement-verification">End-User License Agreement Verification</h4>

<h5 id="description">Description</h5>

<p>This feature provides a mechanism for a tool provider to specify a link to a EULA or terms of service they wish to show to students submitting homework.</p>

<p>This feature also guarantees that the user has agreed to the EULA/terms of service before they submit homework. The timestamp of when the user agreed is also provided to the tool provider during the normal submission/attachment retrieval flow.</p>

<h5 id="implementation">Implementation</h5>

<p>To implement this feature a tool provider must add the <code>vnd.Canvas.Eula</code> service to the <code>service_offered</code> array of their tool proxy:</p>

<pre class="code json"><code class="json">{
  …
  &quot;service_offered&quot;: [
    …
    {
      // Must end in &quot;#vnd.Canvas.Eula&quot;
      &quot;@id&quot;: &quot;my.tool.com/service#vnd.Canvas.Eula&quot;,
      &quot;endpoint&quot;: &quot;http://my.tool.com/eula&quot;, // URL of EULA for Canvas to link to
      &quot;@type&quot;: &quot;RestService&quot;,
      &quot;format&quot;: [&quot;application/json&quot;],
      &quot;action&quot;: [&quot;GET&quot;]
    },
    …
  ],
  …
}
</code></pre>

<p>As shown in the example above the value of <code>endpoint</code> should be a fully qualified URL pointing to the tool provider’s terms of service or EULA. The value of the <code>@id</code> must end in <code>#vnd.Canvas.Eula</code>. The <code>action</code> array must contain <code>GET</code>.</p>

<p>Once the tool is registered in Canvas and associated with an assignment, students will be presented with a link to the tool’s EULA that they must agree to before Canvas will allow a homework submission:</p>

<p><img style="width:35vw;" src="./images/eula.png" alt="Submission details" /></p>

<p>When the tool provider retrieves the assignment details from Canvas the body of the response payload will contain a property named <code>eula_agreement_timestamp</code> which contains the timestamp indicating when the user clicked the checkbox:</p>

<pre class="code json"><code class="json">{
   &quot;id&quot;:215,
   &quot;submitted_at&quot;:&quot;2017-10-17T14:28:09Z&quot;,
   &quot;assignment_id&quot;:216,
   &quot;user_id&quot;:&quot;86157096483e6b3a50bfedc6bac902c0b20a824f&quot;,
   &quot;submission_type&quot;:&quot;online_upload&quot;,
   &quot;workflow_state&quot;:&quot;submitted&quot;,
   &quot;attempt&quot;:1,
   &quot;eula_agreement_timestamp&quot;:&quot;1508250487578&quot;,
   &quot;attachments&quot;:[
      {
         &quot;id&quot;:230,
         &quot;size&quot;:14942,
         &quot;filename&quot;:&quot;1508250488_822__Test_Student_Submission.doc&quot;,
         &quot;display_name&quot;:&quot;Test_Student_Submission.doc&quot;,
         &quot;created_at&quot;:&quot;2017-10-17T14:28:08Z&quot;,
         &quot;updated_at&quot;:&quot;2017-10-17T14:28:08Z&quot;,
         &quot;url&quot;:&quot;http://canvas.docker/api/lti/assignments/10000000000216/submissions/10000000000215/attachment/10000000000230&quot;
      }
   ]
}
</code></pre>
</div></div>

    <script type="text/javascript">
  $('h2.api_method_name').each(function(i, el) {
    var subtopic = $(el).data('subtopic');
    var $a = $(el).find('a');
    if ($.trim($a[0].innerHTML) == '')
      return;
    var $row = $('table#quicklinks tr').filter(function() { return $(this).data('subtopic') == subtopic; });
    if ($row.length == 0) {
      $row = $('<tr/>').appendTo($('table#quicklinks'));
      $row.data('subtopic', subtopic);
      $('<th/>').append(subtopic).appendTo($row);
      $('<td/>').appendTo($row);
    }
    var link = $('<a/>').attr('href', '#'+$(el).attr('name')).append($.trim($a[0].innerHTML));
    $row.find('td').append(link);
  });
</script>
<div id="footer">
  &copy; Instructure, Inc. Generated on Thu Dec  2 17:25:06 2021<br>
  This documentation is generated directly from the Canvas LMS source code, available <a href="https://github.com/instructure/canvas-lms">on Github</a>.
</div>

  </body>
</html>
