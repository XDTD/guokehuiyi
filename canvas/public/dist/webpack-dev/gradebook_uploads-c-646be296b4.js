(window["canvasWebpackJsonp"] = window["canvasWebpackJsonp"] || []).push([["gradebook_uploads"],{

/***/ "+voa":
/*!*******************************************************!*\
  !*** ./ui/features/gradebook_uploads/jquery/index.js ***!
  \*******************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! i18n!gradebook_uploads */ \"R79v\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var underscore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! underscore */ \"Y/W1\");\n/* harmony import */ var underscore__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var html_escape__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! html-escape */ \"gI0r\");\n/* harmony import */ var _canvas_i18n_numberHelper__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @canvas/i18n/numberHelper */ \"FdVj\");\n/* harmony import */ var _wait_for_processing__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./wait_for_processing */ \"A3RW\");\n/* harmony import */ var _process_gradebook_upload__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./process_gradebook_upload */ \"Z8fa\");\n/* harmony import */ var _canvas_grading_GradeFormatHelper__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @canvas/grading/GradeFormatHelper */ \"5Pfy\");\n/* harmony import */ var slickgrid__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! slickgrid */ \"sbFY\");\n/* harmony import */ var slickgrid_slick_editors__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! slickgrid/slick.editors */ \"l/ju\");\n/* harmony import */ var _canvas_forms_jquery_jquery_instructure_forms__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @canvas/forms/jquery/jquery.instructure_forms */ \"Dhso\");\n/* harmony import */ var _canvas_jquery_jquery_instructure_misc_helpers__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @canvas/jquery/jquery.instructure_misc_helpers */ \"8JEM\");\n/* harmony import */ var _canvas_util_templateData__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @canvas/util/templateData */ \"TvTI\");\n/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n\n\n\n\n\n\n\n/* global Slick */\n\n\n/* global.Slick.Editors */\n\n\n/* errorBox */\n\n\n/* /\\.detect/ */\n\n\n/* fillTemplateData */\n\nfunction shouldHighlightScoreChange(oldValue, newValue) {\n  // Even if canvas is operating in a locale that does commas as\n  // the decimal separator, the text that represents the score\n  // is sent period separated.\n  const originalGrade = Number.parseFloat(oldValue);\n  const updatedGrade = Number.parseFloat(newValue);\n  const updateWillRemoveGrade = !Number.isNaN(originalGrade) && Number.isNaN(updatedGrade);\n  return originalGrade > updatedGrade || updateWillRemoveGrade;\n}\n\nconst GradebookUploader = {\n  createGeneralFormatter(attribute) {\n    return function (row, cell, value) {\n      return value ? Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(value[attribute]) : '';\n    };\n  },\n\n  createGrid($container, {\n    data,\n    columns,\n    options\n  }) {\n    return new Slick.Grid($container, data, columns, options);\n  },\n\n  createNumberFormatter(attribute) {\n    return function (row, cell, value) {\n      return value ? _canvas_grading_GradeFormatHelper__WEBPACK_IMPORTED_MODULE_7__[\"default\"].formatGrade(value[attribute]) : '';\n    };\n  },\n\n  init(uploadedGradebook) {\n    const $gradebook_grid = jquery__WEBPACK_IMPORTED_MODULE_1___default()('#gradebook_grid');\n    const $gradebook_grid_header = jquery__WEBPACK_IMPORTED_MODULE_1___default()('#gradebook_grid_header');\n    const rowsToHighlight = [];\n    let gradebookGrid;\n    const gridData = {\n      columns: [{\n        id: 'student',\n        name: i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('student', 'Student'),\n        field: 'student',\n        width: 250,\n        cssClass: 'cell-title',\n        formatter: GradebookUploader.createGeneralFormatter('name')\n      }],\n      options: {\n        enableAddRow: false,\n        editable: true,\n        enableColumnReorder: false,\n        asyncEditorLoading: true,\n        rowHeight: 30\n      },\n      data: []\n    };\n    const labelData = {\n      columns: [{\n        id: 'assignmentGrouping',\n        name: '',\n        field: 'assignmentGrouping',\n        width: 250\n      }],\n      options: {\n        enableAddRow: false,\n        enableColumnReorder: false,\n        asyncEditorLoading: false\n      },\n      data: []\n    };\n    delete uploadedGradebook.missing_objects;\n    delete uploadedGradebook.original_submissions;\n    jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook.assignments, function () {\n      const newGrade = {\n        id: this.id,\n        type: 'assignments',\n        name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('To')),\n        field: this.id,\n        width: 125,\n        editor: Slick.Editors.UploadGradeCellEditor,\n        formatter: GradebookUploader.createNumberFormatter('grade'),\n        active: true,\n        previous_id: this.previous_id,\n        cssClass: 'new-grade'\n      };\n\n      if (this.grading_type !== 'letter_grade') {\n        newGrade.editorFormatter = function (grade) {\n          return _canvas_grading_GradeFormatHelper__WEBPACK_IMPORTED_MODULE_7__[\"default\"].formatGrade(grade, {\n            defaultValue: ''\n          });\n        };\n\n        newGrade.editorParser = _canvas_grading_GradeFormatHelper__WEBPACK_IMPORTED_MODULE_7__[\"default\"].delocalizeGrade;\n      }\n\n      const conflictingGrade = {\n        id: `${this.id}_conflicting`,\n        width: 125,\n        formatter: GradebookUploader.createNumberFormatter('original_grade'),\n        field: `${this.id}_conflicting`,\n        name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('From')),\n        cssClass: 'conflicting-grade'\n      };\n      const assignmentHeaderColumn = {\n        id: this.id,\n        width: 250,\n        name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(this.title),\n        headerCssClass: 'assignment'\n      };\n      labelData.columns.push(assignmentHeaderColumn);\n      gridData.columns.push(conflictingGrade);\n      gridData.columns.push(newGrade);\n    });\n    uploadedGradebook.custom_columns.forEach(column => {\n      const newCustomColumn = {\n        id: `custom_col_${column.id}`,\n        customColumnId: column.id,\n        type: 'custom_column',\n        name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('To')),\n        field: `custom_col_${column.id}`,\n        width: 125,\n        editor: Slick.Editors.UploadGradeCellEditor,\n        formatter: GradebookUploader.createGeneralFormatter('new_content'),\n        editorFormatter: 'custom_column',\n        editorParser: 'custom_column',\n        active: true,\n        cssClass: 'new-grade'\n      };\n      const conflictingCustomColumn = {\n        id: `custom_col_${column.id}_conflicting`,\n        width: 125,\n        formatter: GradebookUploader.createGeneralFormatter('current_content'),\n        field: `custom_col_${column.id}_conflicting`,\n        name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('From')),\n        cssClass: 'conflicting-grade'\n      };\n      const customColumnHeaderColumn = {\n        id: `custom_col_${column.id}`,\n        width: 250,\n        name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(column.title),\n        headerCssClass: 'assignment'\n      };\n      labelData.columns.push(customColumnHeaderColumn);\n      gridData.columns.push(conflictingCustomColumn);\n      gridData.columns.push(newCustomColumn);\n    });\n\n    if (uploadedGradebook.override_scores != null) {\n      const overrideScores = uploadedGradebook.override_scores;\n\n      if (overrideScores.includes_course_scores) {\n        this.addOverrideScoreChangeColumn(labelData, gridData);\n      }\n\n      overrideScores.grading_periods.forEach(gradingPeriod => {\n        this.addOverrideScoreChangeColumn(labelData, gridData, gradingPeriod);\n      });\n    }\n\n    jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook.students, function (index) {\n      var _currentStudent$overr;\n\n      const row = {\n        student: this,\n        id: this.id\n      };\n      jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(this.submissions, function () {\n        if (shouldHighlightScoreChange(this.original_grade, this.grade) && (this.grade || '').toUpperCase() !== 'EX') {\n          rowsToHighlight.push({\n            rowIndex: index,\n            id: this.assignment_id\n          });\n        }\n\n        row.assignmentId = this.assignment_id;\n        row[this.assignment_id] = this;\n        row[`${this.assignment_id}_conflicting`] = this;\n      });\n      jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(this.custom_column_data, function () {\n        if (this.current_content !== this.new_content) {\n          rowsToHighlight.push({\n            rowIndex: index,\n            id: `custom_col_${this.column_id}`\n          });\n        }\n\n        row[`custom_col_${this.column_id}`] = this;\n        row[`custom_col_${this.column_id}_conflicting`] = this;\n      });\n      const currentStudent = this;\n      (_currentStudent$overr = currentStudent.override_scores) === null || _currentStudent$overr === void 0 ? void 0 : _currentStudent$overr.forEach(overrideScore => {\n        const id = overrideScore.grading_period_id || 'course';\n        const columnId = `override_score_${id}`;\n\n        if (shouldHighlightScoreChange(overrideScore.current_score, overrideScore.new_score)) {\n          rowsToHighlight.push({\n            rowIndex: index,\n            id: columnId\n          });\n        }\n\n        row[columnId] = overrideScore;\n        row[`${columnId}_conflicting`] = overrideScore;\n      });\n      gridData.data.push(row);\n      row.active = true;\n    }); // if there are still assignments with changes detected.\n\n    if (gridData.columns.length > 1) {\n      if (uploadedGradebook.unchanged_assignments) {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()('#assignments_without_changes_alert').show();\n      }\n\n      const $gradebookGridForm = jquery__WEBPACK_IMPORTED_MODULE_1___default()('#gradebook_grid_form');\n      $gradebookGridForm.submit(e => {\n        e.preventDefault();\n        $gradebookGridForm.disableWhileLoading(_process_gradebook_upload__WEBPACK_IMPORTED_MODULE_6__[\"default\"].upload(uploadedGradebook));\n      }).show();\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).resize(() => {\n        $gradebook_grid.height(jquery__WEBPACK_IMPORTED_MODULE_1___default()(window).height() - $gradebook_grid.offset().top - 150);\n        const width = (gridData.columns.length - 1) * 125 + 250;\n        $gradebook_grid.parent().width(width);\n      }).triggerHandler('resize');\n      gradebookGrid = GradebookUploader.createGrid($gradebook_grid, gridData);\n      GradebookUploader.createGrid($gradebook_grid_header, labelData);\n      const gradeReviewRow = {};\n\n      for (let i = 0; i < rowsToHighlight.length; i++) {\n        const id = rowsToHighlight[i].id;\n        const rowIndex = rowsToHighlight[i].rowIndex;\n        const conflictingId = `${id}_conflicting`;\n        gradeReviewRow[rowIndex] = gradeReviewRow[rowIndex] || {};\n        gradeReviewRow[rowIndex][id] = 'right-highlight';\n        gradeReviewRow[rowIndex][conflictingId] = 'left-highlight';\n        gradebookGrid.invalidateRow(rowIndex);\n      }\n\n      gradebookGrid.setCellCssStyles('highlight-grade-change', gradeReviewRow);\n      gradebookGrid.render();\n    } else {\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()('#no_changes_detected').show();\n    }\n\n    if (uploadedGradebook.warning_messages.prevented_new_assignment_creation_in_closed_period) {\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()('#prevented-new-assignment-in-closed-period').show();\n    }\n\n    if (uploadedGradebook.warning_messages.prevented_grading_ungradeable_submission) {\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()('#prevented-grading-ungradeable-submission').show();\n    }\n\n    if (uploadedGradebook.warning_messages.prevented_changing_read_only_column) {\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()('#prevented_changing_read_only_column').show();\n    }\n  },\n\n  handleThingsNeedingToBeResolved() {\n    return Object(_wait_for_processing__WEBPACK_IMPORTED_MODULE_5__[\"waitForProcessing\"])(ENV.progress).then(uploadedGradebook => {\n      processUploadedGradebook(uploadedGradebook);\n    }).catch(error => {\n      alert(error.message);\n      window.location = ENV.new_gradebook_upload_path;\n    });\n\n    function processUploadedGradebook(uploadedGradebook) {\n      const needingReview = {}; // first, figure out if there is anything that needs to be resolved\n\n      jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(['student', 'assignment'], (i, thing) => {\n        const $template = jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#${thing}_resolution_template`).remove(),\n              $select = $template.find('select');\n        needingReview[thing] = [];\n        jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook[`${thing}s`], function () {\n          if (!this.previous_id) {\n            needingReview[thing].push(this);\n          }\n        });\n\n        if (needingReview[thing].length) {\n          $select.change(function () {\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).next('.points_possible_section').css({\n              opacity: 0\n            });\n\n            if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val() > 0) {\n              // if the thing that was selected is an id( not ignore or add )\n              jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#${thing}_resolution_template select option`).removeAttr('disabled');\n              jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#${thing}_resolution_template select`).each(function () {\n                if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val() != 'ignore') {\n                  jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#${thing}_resolution_template select`).not(this).find(`option[value='${jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val()}']`).attr('disabled', true);\n                }\n              });\n            } else if (jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val() === 'new') {\n              jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).next('.points_possible_section').css({\n                opacity: 1\n              });\n            }\n          });\n          jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook.missing_objects[`${thing}s`], function () {\n            jquery__WEBPACK_IMPORTED_MODULE_1___default()(`<option value=\"${this.id}\" >${Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(this.name || this.title)}</option>`).appendTo($select);\n          });\n          jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(needingReview[thing], (i, record) => {\n            $template.clone(true).fillTemplateData({\n              iterator: record.id,\n              data: {\n                name: record.name,\n                title: record.title,\n                points_possible: i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].n(record.points_possible)\n              }\n            }).appendTo(`#gradebook_importer_resolution_section .${thing}_section table tbody`).show().find('input.points_possible').change(function () {\n              const $this = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this);\n              record.points_possible = _canvas_i18n_numberHelper__WEBPACK_IMPORTED_MODULE_4__[\"default\"].parse($this.val());\n              $this.val(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].n(record.points_possible));\n            });\n          });\n          jquery__WEBPACK_IMPORTED_MODULE_1___default()(`#gradebook_importer_resolution_section, #gradebook_importer_resolution_section .${thing}_section`).show();\n        }\n      }); // end figuring out if thigs need to be resolved\n\n      if (needingReview.student.length || needingReview.assignment.length) {\n        // if there are things that need to be resolved, set up stuff for that form\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()('#gradebook_importer_resolution_section').submit(function (e) {\n          let returnFalse = false;\n          e.preventDefault();\n          jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find('select').each(function () {\n            if (!jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).val()) {\n              returnFalse = true;\n              jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).errorBox(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('errors.select_an_option', 'Please select an option'));\n              return false;\n            }\n          });\n          if (returnFalse) return false;\n          jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find('select').each(function () {\n            const $select = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this),\n                  parts = $select.attr('name').split('_'),\n                  thing = parts[0],\n                  id = parts[1],\n                  val = $select.val();\n\n            switch (val) {\n              case 'new':\n                // do nothing\n                break;\n\n              case 'ignore':\n                // remove the entry from the uploaded gradebook\n                for (const i in uploadedGradebook[`${thing}s`]) {\n                  if (id == uploadedGradebook[`${thing}s`][i].id) {\n                    uploadedGradebook[`${thing}s`].splice(i, 1);\n                    break;\n                  }\n                }\n\n                break;\n\n              default:\n                // merge\n                const obj = underscore__WEBPACK_IMPORTED_MODULE_2___default.a.find(uploadedGradebook[`${thing}s`], thng => id == thng.id);\n\n                obj.id = obj.previous_id = val;\n\n                if (thing === 'assignment') {\n                  // find the original grade for this assignment for each student\n                  jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook.students, function () {\n                    const student = this;\n\n                    const submission = underscore__WEBPACK_IMPORTED_MODULE_2___default.a.find(student.submissions, thng => thng.assignment_id == id);\n\n                    submission.assignment_id = val;\n\n                    const original_submission = underscore__WEBPACK_IMPORTED_MODULE_2___default.a.find(uploadedGradebook.original_submissions, sub => sub.user_id == student.id && sub.assignment_id == val);\n\n                    if (original_submission) {\n                      submission.original_grade = original_submission.score !== '' ? i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].n(original_submission.score) : '';\n                    }\n                  });\n                } else if (thing === 'student') {\n                  // find the original grade for each assignment for this student\n                  jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(obj.submissions, function () {\n                    const submission = this;\n\n                    const original_submission = underscore__WEBPACK_IMPORTED_MODULE_2___default.a.find(uploadedGradebook.original_submissions, sub => sub.user_id == obj.id && sub.assignment_id == submission.assignment_id);\n\n                    if (original_submission) {\n                      submission.original_grade = original_submission.score !== '' ? i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].n(original_submission.score) : '';\n                    }\n                  });\n                }\n\n            }\n          }); // remove assignments that have no changes\n\n          const indexes_to_delete = [];\n          jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook.assignments, index => {\n            if (uploadedGradebook.assignments[index].previous_id && underscore__WEBPACK_IMPORTED_MODULE_2___default.a.every(uploadedGradebook.students, student => {\n              const submission = student.submissions[index];\n              return parseFloat(submission.original_grade) == parseFloat(submission.grade) || !submission.original_grade && !submission.grade;\n            })) {\n              indexes_to_delete.push(index);\n            }\n          });\n\n          underscore__WEBPACK_IMPORTED_MODULE_2___default.a.each(indexes_to_delete.reverse(), index => {\n            uploadedGradebook.assignments.splice(index, 1);\n            jquery__WEBPACK_IMPORTED_MODULE_1___default.a.each(uploadedGradebook.students, function () {\n              this.submissions.splice(index, 1);\n            });\n          });\n\n          if (indexes_to_delete.length != 0) {\n            uploadedGradebook.unchanged_assignments = true;\n          }\n\n          jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).hide();\n          GradebookUploader.init(uploadedGradebook);\n        });\n      } else {\n        // if there is nothing that needs to resolved, just skip to initialize slick grid.\n        GradebookUploader.init(uploadedGradebook);\n      }\n    }\n  },\n\n  addOverrideScoreChangeColumn(labelData, gridData, gradingPeriod = null) {\n    // A null grading period means these changes are for override grades for the course\n    const id = (gradingPeriod === null || gradingPeriod === void 0 ? void 0 : gradingPeriod.id) || 'course';\n    const title = gradingPeriod !== null && gradingPeriod !== void 0 && gradingPeriod.title ? i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Override Score (%{gradingPeriod})', {\n      gradingPeriod: gradingPeriod.title\n    }) : i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Override Score');\n    const newOverrideScoreColumn = {\n      id: `override_score_${id}`,\n      type: 'assignment',\n      name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('To')),\n      field: `override_score_${id}`,\n      width: 125,\n      editor: Slick.Editors.UploadGradeCellEditor,\n      editorFormatter: 'override_score',\n      editorParser: 'override_score',\n      formatter: GradebookUploader.createNumberFormatter('new_score'),\n      active: true,\n      cssClass: 'new-grade'\n    };\n    const conflictingOverrideScoreColumn = {\n      id: `override_score_${id}_conflicting`,\n      width: 125,\n      formatter: GradebookUploader.createNumberFormatter('current_score'),\n      field: `override_score_${id}_conflicting`,\n      name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('From')),\n      cssClass: 'conflicting-grade'\n    };\n    gridData.columns.push(conflictingOverrideScoreColumn, newOverrideScoreColumn);\n    const overrideScoreHeaderColumn = {\n      id: `override_score_${id}`,\n      width: 250,\n      name: Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(title),\n      headerCssClass: 'assignment'\n    };\n    labelData.columns.push(overrideScoreHeaderColumn);\n  }\n\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (GradebookUploader);\n\n//# sourceURL=webpack:///./ui/features/gradebook_uploads/jquery/index.js?");

/***/ }),

/***/ "3kPo":
/*!************************************************!*\
  !*** ./ui/features/gradebook_uploads/index.js ***!
  \************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _jquery_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./jquery/index */ \"+voa\");\n/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\njquery__WEBPACK_IMPORTED_MODULE_0___default()(_jquery_index__WEBPACK_IMPORTED_MODULE_1__[\"default\"].handleThingsNeedingToBeResolved);\n\n//# sourceURL=webpack:///./ui/features/gradebook_uploads/index.js?");

/***/ }),

/***/ "A3RW":
/*!*********************************************************************!*\
  !*** ./ui/features/gradebook_uploads/jquery/wait_for_processing.js ***!
  \*********************************************************************/
/*! exports provided: waitForProcessing */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"waitForProcessing\", function() { return waitForProcessing; });\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _canvas_jquery_jquery_ajaxJSON__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @canvas/jquery/jquery.ajaxJSON */ \"dhbk\");\n/* harmony import */ var i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! i18n!gradebook_uploads */ \"R79v\");\n/* harmony import */ var spin_js_jquery_spin__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! spin.js/jquery.spin */ \"yvkg\");\n/* harmony import */ var spin_js_jquery_spin__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(spin_js_jquery_spin__WEBPACK_IMPORTED_MODULE_3__);\n/*\n * Copyright (C) 2015 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n // eslint-disable-line no-unused-vars\n\n\n\n\nasync function sleep(milliseconds) {\n  return new Promise(resolve => {\n    setTimeout(resolve, milliseconds);\n  });\n}\n/**\n * The sleep_time parameter is included here to speed up testing.\n * There is an issue with jest.useFakeTimers and native Promises\n * that prevents this from being tested efficiently otherwise.\n * https://github.com/facebook/jest/issues/7151\n */\n\n\nasync function waitForProcessing(progress, sleep_time = 2000) {\n  var _progress$message;\n\n  const spinner = jquery__WEBPACK_IMPORTED_MODULE_0___default()('#spinner').spin();\n\n  while (!['completed', 'failed'].includes(progress.workflow_state)) {\n    /* eslint-disable no-await-in-loop */\n    await sleep(sleep_time);\n    progress = await jquery__WEBPACK_IMPORTED_MODULE_0___default.a.ajaxJSON(`/api/v1/progress/${progress.id}`, 'GET').promise();\n    /* eslint-enable no-await-in-loop */\n  }\n\n  if (progress.workflow_state === 'completed') {\n    const uploadedGradebook = await jquery__WEBPACK_IMPORTED_MODULE_0___default.a.ajaxJSON(ENV.uploaded_gradebook_data_path, 'GET').promise();\n    spinner.hide();\n    return uploadedGradebook;\n  } else if ((_progress$message = progress.message) !== null && _progress$message !== void 0 && _progress$message.includes('Invalid header row')) {\n    throw new Error(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_2__[\"default\"].t('The CSV header row is invalid.'));\n  } else {\n    throw new Error(i18n_gradebook_uploads__WEBPACK_IMPORTED_MODULE_2__[\"default\"].t('An unknown error has occurred. Verify the CSV file or try again later.'));\n  }\n}\n\n//# sourceURL=webpack:///./ui/features/gradebook_uploads/jquery/wait_for_processing.js?");

/***/ }),

/***/ "BwtL":
/*!*********************************************************************************!*\
  !*** ./frontend_build/i18n.js?gradebook_upload!./ui/shims/dummyI18nResource.js ***!
  \*********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/i18n/i18nObj */ \"HGxv\");\n/* harmony import */ var translations_core_en__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! translations/_core_en */ \"0sPK\");\n\n    \n    \n    \n\n    /* harmony default export */ __webpack_exports__[\"default\"] = (_canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scoped('gradebook_upload'));\n  \n\n//# sourceURL=webpack:///./ui/shims/dummyI18nResource.js?./frontend_build/i18n.js?gradebook_upload");

/***/ }),

/***/ "R79v":
/*!**********************************************************************************!*\
  !*** ./frontend_build/i18n.js?gradebook_uploads!./ui/shims/dummyI18nResource.js ***!
  \**********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/i18n/i18nObj */ \"HGxv\");\n/* harmony import */ var translations_core_en__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! translations/_core_en */ \"0sPK\");\n\n    \n    \n    \n\n    /* harmony default export */ __webpack_exports__[\"default\"] = (_canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scoped('gradebook_uploads'));\n  \n\n//# sourceURL=webpack:///./ui/shims/dummyI18nResource.js?./frontend_build/i18n.js?gradebook_uploads");

/***/ }),

/***/ "TvTI":
/*!****************************************!*\
  !*** ./ui/shared/util/templateData.js ***!
  \****************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var html_escape__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! html-escape */ \"gI0r\");\n/* harmony import */ var _canvas_jquery_jquery_instructure_misc_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @canvas/jquery/jquery.instructure_misc_helpers */ \"8JEM\");\n/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n\n/* replaceTags */\n// Fills the selected object(s) with data values as specified.  Plaintext values should be specified in the\n//  data: data used to fill template.\n//  id: set the id attribute of the template object\n//  textValues: a list of strings, which values should be plaintext\n//  htmlValues: a list of strings, which values should be html\n//  hrefValues: List of string.  Searches for all anchor tags in the template\n//    and globally replaces \"{{ value }}\" with data[value].  Useful for adding\n//    new elements asynchronously, when you don't know what their URL will be\n//    until they're created.\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.fn.fillTemplateData = function (options) {\n  if (this.length && options) {\n    if (options.iterator) {\n      //  todo: replace .andSelf with .addBack when JQuery is upgraded.\n      this.find('*').andSelf().each(function () {\n        const $el = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);\n        jquery__WEBPACK_IMPORTED_MODULE_0___default.a.each(['name', 'id', 'class'], (i, attr) => {\n          if ($el.attr(attr)) {\n            $el.attr(attr, $el.attr(attr).replace(/-iterator-/, options.iterator));\n          }\n        });\n      });\n    }\n\n    if (options.id) {\n      this.attr('id', options.id);\n    }\n\n    let contentChange = false;\n\n    if (options.data) {\n      for (var item in options.data) {\n        if (options.except && jquery__WEBPACK_IMPORTED_MODULE_0___default.a.inArray(item, options.except) != -1) {\n          continue;\n        }\n\n        if (options.data[item] && options.dataValues && jquery__WEBPACK_IMPORTED_MODULE_0___default.a.inArray(item, options.dataValues) != -1) {\n          this.data(item, options.data[item].toString());\n        }\n\n        const $found_all = this.find('.' + item);\n        var avoid = options.avoid || '';\n        $found_all.each(function () {\n          const $found = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this);\n\n          if ($found.length > 0 && $found.closest(avoid).length === 0) {\n            if (typeof options.data[item] === 'undefined' || options.data[item] === null) {\n              options.data[item] = '';\n            }\n\n            if (options.htmlValues && jquery__WEBPACK_IMPORTED_MODULE_0___default.a.inArray(item, options.htmlValues) != -1) {\n              $found.html(jquery__WEBPACK_IMPORTED_MODULE_0___default.a.raw(options.data[item].toString()));\n\n              if ($found.hasClass('user_content')) {\n                contentChange = true;\n                $found.removeClass('enhanced');\n                $found.data('unenhanced_content_html', options.data[item].toString());\n              }\n            } else if ($found[0].tagName.toUpperCase() == 'INPUT') {\n              $found.val(options.data[item]);\n            } else {\n              try {\n                const str = options.data[item].toString();\n                $found.html(Object(html_escape__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(str));\n              } catch (e) {}\n            }\n          }\n        });\n      }\n    }\n\n    if (options.hrefValues && options.data) {\n      this.find('a,span[rel]').each(function () {\n        let $obj = jquery__WEBPACK_IMPORTED_MODULE_0___default()(this),\n            oldHref,\n            oldRel,\n            oldName;\n\n        for (const i in options.hrefValues) {\n          if (!options.hrefValues.hasOwnProperty(i)) {\n            continue;\n          }\n\n          const name = options.hrefValues[i];\n\n          if (oldHref = $obj.attr('href')) {\n            const newHref = jquery__WEBPACK_IMPORTED_MODULE_0___default.a.replaceTags(oldHref, name, encodeURIComponent(options.data[name]));\n            const orig = $obj.text() === $obj.html() ? $obj.text() : null;\n\n            if (oldHref !== newHref) {\n              $obj.attr('href', newHref);\n\n              if (orig) {\n                $obj.text(orig);\n              }\n            }\n          }\n\n          if (oldRel = $obj.attr('rel')) {\n            $obj.attr('rel', jquery__WEBPACK_IMPORTED_MODULE_0___default.a.replaceTags(oldRel, name, options.data[name]));\n          }\n\n          if (oldName = $obj.attr('name')) {\n            $obj.attr('name', jquery__WEBPACK_IMPORTED_MODULE_0___default.a.replaceTags(oldName, name, options.data[name]));\n          }\n        }\n      });\n    }\n\n    if (contentChange) {\n      jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).triggerHandler('user_content_change');\n    }\n  }\n\n  return this;\n};\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.fn.fillTemplateData.defaults = {\n  htmlValues: null,\n  hrefValues: null\n}; // Reverse version of fillTemplateData.  Lets you pull out the string versions of values held in divs, spans, etc.\n// Based on the usage of class names within an object to specify an object's sub-parts.\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.fn.getTemplateData = function (options) {\n  if (!this.length || !options) {\n    return {};\n  }\n\n  var result = {},\n      item,\n      val;\n\n  if (options.textValues) {\n    const _this = this;\n\n    options.textValues.forEach(item => {\n      const $item = _this.find('.' + item.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]') + ':first');\n\n      val = jquery__WEBPACK_IMPORTED_MODULE_0___default.a.trim($item.text());\n\n      if ($item.html() === '&nbsp;') {\n        val = '';\n      }\n\n      if (val.length === 1 && val.charCodeAt(0) === 160) {\n        val = '';\n      }\n\n      result[item] = val;\n    });\n  }\n\n  if (options.dataValues) {\n    for (item in options.dataValues) {\n      var val = this.data(options.dataValues[item]);\n\n      if (val) {\n        result[options.dataValues[item]] = val;\n      }\n    }\n  }\n\n  if (options.htmlValues) {\n    for (item in options.htmlValues) {\n      const $elem = this.find('.' + options.htmlValues[item].replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]') + ':first');\n      val = null;\n\n      if ($elem.hasClass('user_content') && $elem.data('unenhanced_content_html')) {\n        val = $elem.data('unenhanced_content_html');\n      } else {\n        val = jquery__WEBPACK_IMPORTED_MODULE_0___default.a.trim($elem.html());\n      }\n\n      result[options.htmlValues[item]] = val;\n    }\n  }\n\n  return result;\n};\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.fn.getTemplateValue = function (value, options) {\n  const opts = jquery__WEBPACK_IMPORTED_MODULE_0___default.a.extend({}, options, {\n    textValues: [value]\n  });\n  return this.getTemplateData(opts)[value];\n};\n\n//# sourceURL=webpack:///./ui/shared/util/templateData.js?");

/***/ }),

/***/ "Z8fa":
/*!**************************************************************************!*\
  !*** ./ui/features/gradebook_uploads/jquery/process_gradebook_upload.js ***!
  \**************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/esm/slicedToArray */ \"ODXe\");\n/* harmony import */ var _babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/esm/objectSpread2 */ \"VTBJ\");\n/* harmony import */ var underscore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! underscore */ \"Y/W1\");\n/* harmony import */ var underscore__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var i18n_gradebook_upload__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! i18n!gradebook_upload */ \"BwtL\");\n/* harmony import */ var _canvas_jquery_jquery_ajaxJSON__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @canvas/jquery/jquery.ajaxJSON */ \"dhbk\");\n\n\n\n/*\n * Copyright (C) 2015 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n\n\nconst successMessage = i18n_gradebook_upload__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t('You will be redirected to Gradebook while your file is being uploaded. ' + 'If you have a large CSV file, your changes may take a few minutes to update. ' + 'To prevent overwriting any data, please confirm the upload has completed and ' + 'Gradebook is correct before making additional changes.');\n\nfunction overrideScoreHasChanged(score) {\n  const currentScore = Number.parseFloat(score.current_score);\n  const newScore = Number.parseFloat(score.new_score);\n\n  if (Number.isNaN(currentScore) && Number.isNaN(newScore)) {\n    return false;\n  }\n\n  return currentScore !== newScore;\n}\n\nconst ProcessGradebookUpload = {\n  upload(gradebook) {\n    if (gradebook == null || gradebook.students == null || gradebook.students.length === 0) {\n      return;\n    } // Between assignment creation, score updates, custom column updates, and\n    // override score updates, we very possibly have multiple requests to send\n    // off. Make sure they've all returned (even if just returning a Progress\n    // object) before we direct the user back to Gradebook.\n\n\n    let uploadingBulkData = false;\n    const deferreds = [];\n\n    if (gradebook.custom_columns && gradebook.custom_columns.length > 0) {\n      const deferred = this.uploadCustomColumnData(gradebook);\n\n      if (deferred != null) {\n        uploadingBulkData = true;\n        deferreds.push(deferred);\n      }\n    }\n\n    const overrideScoresExist = gradebook.students.some(student => student.override_scores != null && student.override_scores.length > 0);\n\n    if (overrideScoresExist && ENV.bulk_update_override_scores_path != null) {\n      const updateRequests = this.createOverrideUpdateRequests(gradebook);\n\n      if (updateRequests.length > 0) {\n        uploadingBulkData = true;\n        deferreds.push(...updateRequests);\n      }\n    }\n\n    const createAssignmentsDfds = this.createAssignments(gradebook);\n    const uploadGradeDataDfd = jquery__WEBPACK_IMPORTED_MODULE_3___default.a.Deferred();\n    jquery__WEBPACK_IMPORTED_MODULE_3___default.a.when(...createAssignmentsDfds).then((...responses) => {\n      const uploadRequest = this.uploadGradeData(gradebook, responses);\n\n      if (uploadRequest != null) {\n        uploadingBulkData = true;\n        jquery__WEBPACK_IMPORTED_MODULE_3___default.a.when(uploadRequest).then(_response => {\n          uploadGradeDataDfd.resolve();\n        });\n      } else {\n        uploadGradeDataDfd.resolve();\n      }\n    });\n    deferreds.push(...createAssignmentsDfds, uploadGradeDataDfd);\n    return jquery__WEBPACK_IMPORTED_MODULE_3___default.a.when(...deferreds).then(() => {\n      if (uploadingBulkData) {\n        alert(successMessage); // eslint-disable-line no-alert\n      }\n\n      this.goToGradebook();\n    });\n  },\n\n  uploadCustomColumnData(gradebook) {\n    const customColumnData = gradebook.students.reduce((accumulator, student) => {\n      const student_id = Number.parseInt(student.id, 10);\n\n      if (!(student_id in accumulator)) {\n        accumulator[student_id] = student.custom_column_data;\n      }\n\n      return accumulator;\n    }, {});\n\n    if (!underscore__WEBPACK_IMPORTED_MODULE_2___default.a.isEmpty(customColumnData)) {\n      const parsedData = this.parseCustomColumnData(customColumnData);\n      return this.submitCustomColumnData(parsedData);\n    }\n  },\n\n  parseCustomColumnData(customColumnData) {\n    const data = [];\n    Object.keys(customColumnData).forEach(studentId => {\n      customColumnData[studentId].forEach(column => {\n        data.push({\n          column_id: Number.parseInt(column.column_id, 10),\n          user_id: studentId,\n          content: column.new_content\n        });\n      });\n    });\n    return data;\n  },\n\n  submitCustomColumnData(data) {\n    return jquery__WEBPACK_IMPORTED_MODULE_3___default.a.ajaxJSON(ENV.bulk_update_custom_columns_path, 'PUT', JSON.stringify({\n      column_data: data\n    }), null, null, {\n      contentType: 'application/json'\n    });\n  },\n\n  createOverrideUpdateRequests(gradebook) {\n    const changedOverrideScores = gradebook.students.map(student => (student.override_scores || []).map(score => Object(_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(Object(_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({}, score), {}, {\n      student_id: student.id\n    }))).flat().filter(score => overrideScoreHasChanged(score)); // If we have updates for multiple grading periods--which will never happen\n    // with the default gradebook export but could happen if someone uploads a\n    // CSV with multiple \"Override Score\" columns--send off one request to the\n    // endpoint for each grading period.\n\n    const scoresByGradingPeriod = underscore__WEBPACK_IMPORTED_MODULE_2___default.a.groupBy(changedOverrideScores, score => score.grading_period_id || 'course');\n\n    return Object.entries(scoresByGradingPeriod).map(([gradingPeriodId, scores]) => {\n      const submittableScores = scores.map(score => ({\n        override_score: score.new_score,\n        student_id: score.student_id\n      }));\n      return this.createOverrideScoreRequest(gradingPeriodId, submittableScores);\n    });\n  },\n\n  createOverrideScoreRequest(gradingPeriodId, scores) {\n    const params = {\n      override_scores: scores\n    };\n\n    if (gradingPeriodId !== 'course') {\n      params.grading_period_id = gradingPeriodId;\n    }\n\n    return jquery__WEBPACK_IMPORTED_MODULE_3___default.a.ajaxJSON(ENV.bulk_update_override_scores_path, 'PUT', JSON.stringify(params), null, null, {\n      contentType: 'application/json'\n    });\n  },\n\n  createAssignments(gradebook) {\n    const newAssignments = this.getNewAssignmentsFromGradebook(gradebook);\n    return newAssignments.map(assignment => this.createIndividualAssignment(assignment));\n  },\n\n  getNewAssignmentsFromGradebook(gradebook) {\n    return gradebook.assignments.filter(a => a.id != null && a.id <= 0);\n  },\n\n  createIndividualAssignment(assignment) {\n    return jquery__WEBPACK_IMPORTED_MODULE_3___default.a.ajaxJSON(ENV.create_assignment_path, 'POST', JSON.stringify({\n      assignment: {\n        name: assignment.title,\n        points_possible: assignment.points_possible,\n        published: true\n      },\n      calculate_grades: false\n    }), null, null, {\n      contentType: 'application/json'\n    });\n  },\n\n  uploadGradeData(gradebook, responses) {\n    const gradeData = this.populateGradeData(gradebook, responses);\n    return underscore__WEBPACK_IMPORTED_MODULE_2___default.a.isEmpty(gradeData) ? null : this.submitGradeData(gradeData);\n  },\n\n  populateGradeData(gradebook, responses) {\n    const assignmentMap = this.mapLocalAssignmentsToDatabaseAssignments(gradebook, responses);\n    const gradeData = {};\n    gradebook.students.forEach(student => this.populateGradeDataPerStudent(student, assignmentMap, gradeData));\n    return gradeData;\n  },\n\n  mapLocalAssignmentsToDatabaseAssignments(gradebook, responses) {\n    const newAssignments = this.getNewAssignmentsFromGradebook(gradebook);\n    let responsesLists = responses;\n\n    if (newAssignments.length === 1) {\n      responsesLists = [responses];\n    }\n\n    const assignmentMap = {};\n\n    underscore__WEBPACK_IMPORTED_MODULE_2___default()(newAssignments).zip(responsesLists).forEach(fakeAndCreated => {\n      const _fakeAndCreated = Object(_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(fakeAndCreated, 2),\n            assignmentStub = _fakeAndCreated[0],\n            response = _fakeAndCreated[1];\n\n      const _response2 = Object(_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(response, 1),\n            createdAssignment = _response2[0];\n\n      assignmentMap[assignmentStub.id] = createdAssignment.id;\n    });\n\n    return assignmentMap;\n  },\n\n  populateGradeDataPerStudent(student, assignmentMap, gradeData) {\n    student.submissions.forEach(submission => {\n      this.populateGradeDataPerSubmission(submission, student.previous_id, assignmentMap, gradeData);\n    });\n  },\n\n  populateGradeDataPerSubmission(submission, studentId, assignmentMap, gradeData) {\n    const assignmentId = assignmentMap[submission.assignment_id] || submission.assignment_id;\n    if (assignmentId <= 0) return; // unrecognized and ignored assignments\n\n    if (submission.original_grade === submission.grade) return; // no change\n\n    gradeData[assignmentId] = gradeData[assignmentId] || {};\n    const normalizedGrade = String(submission.grade || '').toUpperCase();\n\n    if (normalizedGrade === 'EX' || normalizedGrade === 'EXCUSED') {\n      gradeData[assignmentId][studentId] = {\n        excuse: true\n      };\n    } else {\n      gradeData[assignmentId][studentId] = {\n        posted_grade: submission.grade\n      };\n    }\n  },\n\n  submitGradeData(gradeData) {\n    return jquery__WEBPACK_IMPORTED_MODULE_3___default.a.ajaxJSON(ENV.bulk_update_path, 'POST', JSON.stringify({\n      grade_data: gradeData\n    }), null, null, {\n      contentType: 'application/json'\n    });\n  },\n\n  goToGradebook() {\n    jquery__WEBPACK_IMPORTED_MODULE_3___default()('#gradebook_grid_form').text(i18n_gradebook_upload__WEBPACK_IMPORTED_MODULE_4__[\"default\"].t('Done.'));\n    window.location = ENV.gradebook_path;\n  }\n\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (ProcessGradebookUpload);\n\n//# sourceURL=webpack:///./ui/features/gradebook_uploads/jquery/process_gradebook_upload.js?");

/***/ }),

/***/ "dGUw":
/*!************************************!*\
  !*** ./packages/jqueryui/mouse.js ***!
  \************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _widget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./widget */ \"dJId\");\n/*!\n * jQuery UI Mouse @VERSION\n *\n * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)\n * Dual licensed under the MIT or GPL Version 2 licenses.\n * http://jquery.org/license\n *\n * http://docs.jquery.com/UI/Mouse\n *\n * Depends:\n *\tjquery.ui.widget.js\n */\n\n\n\nvar mouseHandled = false;\njquery__WEBPACK_IMPORTED_MODULE_0___default()( document ).mouseup( function( e ) {\n\tmouseHandled = false;\n});\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.widget(\"ui.mouse\", {\n\tversion: \"@VERSION\",\n\toptions: {\n\t\tcancel: 'input,textarea,button,select,option',\n\t\tdistance: 1,\n\t\tdelay: 0\n\t},\n\t_mouseInit: function() {\n\t\tvar that = this;\n\n\t\tthis.element\n\t\t\t.bind('mousedown.'+this.widgetName, function(event) {\n\t\t\t\treturn that._mouseDown(event);\n\t\t\t})\n\t\t\t.bind('click.'+this.widgetName, function(event) {\n\t\t\t\tif (true === jquery__WEBPACK_IMPORTED_MODULE_0___default.a.data(event.target, that.widgetName + '.preventClickEvent')) {\n\t\t\t\t\tjquery__WEBPACK_IMPORTED_MODULE_0___default.a.removeData(event.target, that.widgetName + '.preventClickEvent');\n\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.started = false;\n\t},\n\n\t// TODO: make sure destroying one instance of mouse doesn't mess with\n\t// other instances of mouse\n\t_mouseDestroy: function() {\n\t\tthis.element.unbind('.'+this.widgetName);\n\t\tjquery__WEBPACK_IMPORTED_MODULE_0___default()(document)\n\t\t\t.unbind('mousemove.'+this.widgetName, this._mouseMoveDelegate)\n\t\t\t.unbind('mouseup.'+this.widgetName, this._mouseUpDelegate);\n\t},\n\n\t_mouseDown: function(event) {\n\t\t// don't let more than one widget handle mouseStart\n\t\tif( mouseHandled ) { return; }\n\n\t\t// we may have missed mouseup (out of window)\n\t\t(this._mouseStarted && this._mouseUp(event));\n\n\t\tthis._mouseDownEvent = event;\n\n\t\tvar that = this,\n\t\t\tbtnIsLeft = (event.which === 1),\n\t\t\t// event.target.nodeName works around a bug in IE 8 with\n\t\t\t// disabled inputs (#7620)\n\t\t\telIsCancel = (typeof this.options.cancel === \"string\" && event.target.nodeName ? jquery__WEBPACK_IMPORTED_MODULE_0___default()(event.target).closest(this.options.cancel).length : false);\n\t\tif (!btnIsLeft || elIsCancel || !this._mouseCapture(event)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.mouseDelayMet = !this.options.delay;\n\t\tif (!this.mouseDelayMet) {\n\t\t\tthis._mouseDelayTimer = setTimeout(function() {\n\t\t\t\tthat.mouseDelayMet = true;\n\t\t\t}, this.options.delay);\n\t\t}\n\n\t\tif (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {\n\t\t\tthis._mouseStarted = (this._mouseStart(event) !== false);\n\t\t\tif (!this._mouseStarted) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// Click event may never have fired (Gecko & Opera)\n\t\tif (true === jquery__WEBPACK_IMPORTED_MODULE_0___default.a.data(event.target, this.widgetName + '.preventClickEvent')) {\n\t\t\tjquery__WEBPACK_IMPORTED_MODULE_0___default.a.removeData(event.target, this.widgetName + '.preventClickEvent');\n\t\t}\n\n\t\t// these delegates are required to keep context\n\t\tthis._mouseMoveDelegate = function(event) {\n\t\t\treturn that._mouseMove(event);\n\t\t};\n\t\tthis._mouseUpDelegate = function(event) {\n\t\t\treturn that._mouseUp(event);\n\t\t};\n\t\tjquery__WEBPACK_IMPORTED_MODULE_0___default()(document)\n\t\t\t.bind('mousemove.'+this.widgetName, this._mouseMoveDelegate)\n\t\t\t.bind('mouseup.'+this.widgetName, this._mouseUpDelegate);\n\n\t\tevent.preventDefault();\n\t\t\n\t\tmouseHandled = true;\n\t\treturn true;\n\t},\n\n\t_mouseMove: function(event) {\n\t\t// IE mouseup check - mouseup happened when mouse was out of window\n\t\tif (jquery__WEBPACK_IMPORTED_MODULE_0___default.a.browser.msie && !(document.documentMode >= 9) && !event.button) {\n\t\t\treturn this._mouseUp(event);\n\t\t}\n\n\t\tif (this._mouseStarted) {\n\t\t\tthis._mouseDrag(event);\n\t\t\treturn event.preventDefault();\n\t\t}\n\n\t\tif (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {\n\t\t\tthis._mouseStarted =\n\t\t\t\t(this._mouseStart(this._mouseDownEvent, event) !== false);\n\t\t\t(this._mouseStarted ? this._mouseDrag(event) : this._mouseUp(event));\n\t\t}\n\n\t\treturn !this._mouseStarted;\n\t},\n\n\t_mouseUp: function(event) {\n\t\tjquery__WEBPACK_IMPORTED_MODULE_0___default()(document)\n\t\t\t.unbind('mousemove.'+this.widgetName, this._mouseMoveDelegate)\n\t\t\t.unbind('mouseup.'+this.widgetName, this._mouseUpDelegate);\n\n\t\tif (this._mouseStarted) {\n\t\t\tthis._mouseStarted = false;\n\n\t\t\tif (event.target === this._mouseDownEvent.target) {\n\t\t\t\tjquery__WEBPACK_IMPORTED_MODULE_0___default.a.data(event.target, this.widgetName + '.preventClickEvent', true);\n\t\t\t}\n\n\t\t\tthis._mouseStop(event);\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t_mouseDistanceMet: function(event) {\n\t\treturn (Math.max(\n\t\t\t\tMath.abs(this._mouseDownEvent.pageX - event.pageX),\n\t\t\t\tMath.abs(this._mouseDownEvent.pageY - event.pageY)\n\t\t\t) >= this.options.distance\n\t\t);\n\t},\n\n\t_mouseDelayMet: function(event) {\n\t\treturn this.mouseDelayMet;\n\t},\n\n\t// These are placeholder methods, to be overriden by extending plugin\n\t_mouseStart: function(event) {},\n\t_mouseDrag: function(event) {},\n\t_mouseStop: function(event) {},\n\t_mouseCapture: function(event) { return true; }\n});\n\n\n\n\n//# sourceURL=webpack:///./packages/jqueryui/mouse.js?");

/***/ })

}]);