(window["canvasWebpackJsonp"] = window["canvasWebpackJsonp"] || []).push([[3693],{

/***/ "FtDy":
/*!**********************************************************************!*\
  !*** ./ui/shared/message-students-dialog/jquery/message_students.js ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! i18n!public_message_students */ \"iDn3\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _canvas_util_natcompare__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @canvas/util/natcompare */ \"plYi\");\n/* harmony import */ var _canvas_i18n_numberHelper__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @canvas/i18n/numberHelper */ \"FdVj\");\n/* harmony import */ var _canvas_forms_jquery_jquery_instructure_forms__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @canvas/forms/jquery/jquery.instructure_forms */ \"Dhso\");\n/* harmony import */ var jqueryui_dialog__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! jqueryui/dialog */ \"ESjL\");\n/* harmony import */ var _canvas_jquery_jquery_instructure_misc_plugins__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @canvas/jquery/jquery.instructure_misc_plugins */ \"aq8L\");\n/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n\n\n\n/* formSubmit */\n\n\n\n/* showIf */\n\nlet currentSettings = {};\n\nfunction checkSendable() {\n  const $message_students_dialog = messageStudentsDialog();\n  disableSend($message_students_dialog.find('#body').val().length == 0 || $message_students_dialog.find('.student:not(.blank):visible').length == 0);\n}\n/* global messageStudents */\n\n\nwindow.messageStudents = function (settings) {\n  const $message_students_dialog = messageStudentsDialog();\n  currentSettings = settings;\n  $message_students_dialog.find('.message_types').empty();\n\n  for (let idx = 0, l = settings.options.length; idx < l; idx++) {\n    const $option = jquery__WEBPACK_IMPORTED_MODULE_1___default()('<option/>');\n    const option = settings.options[idx];\n    $option.val(idx).text(option.text);\n    $message_students_dialog.find('.message_types').append($option);\n  }\n\n  const title = settings.title,\n        $li = $message_students_dialog.find('ul li.blank:first'),\n        $ul = $message_students_dialog.find('ul'),\n        students_hash = {};\n  $message_students_dialog.find('ul li:not(.blank)').remove();\n  const sortedStudents = settings.students.slice();\n  sortedStudents.sort(_canvas_util_natcompare__WEBPACK_IMPORTED_MODULE_2__[\"default\"].byKey('sortableName'));\n\n  for (let i = 0; i < sortedStudents.length; i++) {\n    const student = sortedStudents[i];\n    const $student = $li.clone(true).removeClass('blank');\n    $student.find('.name').text(student.name);\n    $student.find('.score').text(student.score);\n    const remove_text = i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Remove %{student} from recipients', {\n      student: student.name\n    });\n    const $remove_button = $student.find('.remove-button');\n    $remove_button.attr('title', remove_text).append(jquery__WEBPACK_IMPORTED_MODULE_1___default()(\"<span class='screenreader-only'></span>\").text(remove_text));\n    $remove_button.click(function (event) {\n      event.preventDefault(); // hide the selected student\n\n      const $s = jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).closest('li');\n      $s.hide('fast', checkSendable); // focus the next visible student, or the subject field if that was the last one in the list\n\n      const $next = $s.nextAll(':visible:first');\n\n      if ($next.length) {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()('button', $next).focus();\n      } else {\n        jquery__WEBPACK_IMPORTED_MODULE_1___default()('#message_assignment_recipients #subject').focus();\n      }\n    });\n    $student.data('id', student.id);\n    $student.user_data = student;\n    $ul.append($student.show());\n    students_hash[student.id] = $student;\n  }\n\n  $ul.show();\n  const dialogTitle = i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Message Students for %{course_name}', {\n    course_name: title\n  });\n  $message_students_dialog.data('students_hash', students_hash), $message_students_dialog.find('.asset_title').text(title);\n  $message_students_dialog.find('.out_of').showIf(settings.points_possible != null);\n  $message_students_dialog.find('.send_button').text(i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('send_message', 'Send Message'));\n  $message_students_dialog.find('.points_possible').text(i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].n(settings.points_possible));\n  $message_students_dialog.find('[name=context_code]').val(settings.context_code);\n  $message_students_dialog.find('textarea').val('');\n  $message_students_dialog.find('select')[0].selectedIndex = 0;\n  $message_students_dialog.find('select').change();\n  $message_students_dialog.dialog({\n    width: 600,\n    modal: true,\n    open: (_event, _ui) => {\n      $message_students_dialog.closest('.ui-dialog').attr('role', 'dialog').attr('aria-label', dialogTitle);\n    },\n    close: (_event, _ui) => {\n      $message_students_dialog.closest('.ui-dialog').removeAttr('role').removeAttr('aria-label');\n    }\n  }).dialog('open').dialog('option', 'title', dialogTitle).on('dialogclose', settings.onClose);\n};\n\njquery__WEBPACK_IMPORTED_MODULE_1___default()(document).ready(() => {\n  const $message_students_dialog = messageStudentsDialog();\n  $message_students_dialog.find('button').click(e => {\n    const btn = jquery__WEBPACK_IMPORTED_MODULE_1___default()(e.target);\n\n    if (btn.hasClass('disabled')) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  });\n  jquery__WEBPACK_IMPORTED_MODULE_1___default()('#message_assignment_recipients').formSubmit({\n    processData(data) {\n      const ids = [];\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find('.student:visible').each(function () {\n        ids.push(jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).data('id'));\n      });\n\n      if (ids.length == 0) {\n        return false;\n      }\n\n      data.recipients = ids.join(',');\n      return data;\n    },\n\n    beforeSubmit(data) {\n      disableButtons(true);\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find('.send_button').text(i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Sending Message...'));\n    },\n\n    success(data) {\n      jquery__WEBPACK_IMPORTED_MODULE_1___default.a.flashMessage(i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Message sent!'));\n      disableButtons(false);\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find('.send_button').text(i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Send Message'));\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()('#message_students_dialog').dialog('close');\n    },\n\n    error(data) {\n      disableButtons(false);\n      jquery__WEBPACK_IMPORTED_MODULE_1___default()(this).find('.send_button').text(i18n_public_message_students__WEBPACK_IMPORTED_MODULE_0__[\"default\"].t('Sending Message Failed, please try again'));\n    }\n\n  });\n\n  const showStudentsMessageSentTo = function () {\n    const optionIdx = parseInt($message_students_dialog.find('select').val(), 10) || 0;\n    const option = currentSettings.options[optionIdx];\n    const studentsHash = $message_students_dialog.data('students_hash');\n    let cutoff = _canvas_i18n_numberHelper__WEBPACK_IMPORTED_MODULE_3__[\"default\"].parse($message_students_dialog.find('.cutoff_score').val());\n\n    if (isNaN(cutoff)) {\n      cutoff = null;\n    }\n\n    const studentElements = Object.values(studentsHash);\n    let selectedStudentIds = [];\n\n    if (studentsHash) {\n      if (option && option.callback) {\n        selectedStudentIds = option.callback.call(window.messageStudents, cutoff, studentElements);\n      } else if (currentSettings.callback) {\n        selectedStudentIds = currentSettings.callback.call(window.messageStudents, option.text, cutoff, studentElements);\n      }\n    }\n\n    if (currentSettings.subjectCallback) {\n      $message_students_dialog.find('[name=subject]').val(currentSettings.subjectCallback(option.text, cutoff));\n    }\n\n    $message_students_dialog.find('.cutoff_holder').showIf(option.cutoff);\n    $message_students_dialog.find('.student_list').toggleClass('show_score', !!(option.cutoff || option.score));\n    disableButtons(selectedStudentIds.length === 0);\n    const selectedIdSet = new Set(selectedStudentIds);\n    Object.entries(studentsHash).forEach(([studentId, studentElement]) => {\n      studentElement.showIf(selectedIdSet.has(studentId));\n    });\n  };\n\n  const closeDialog = function () {\n    $message_students_dialog.dialog('close');\n  };\n\n  $message_students_dialog.find('.cancel_button').click(closeDialog);\n  $message_students_dialog.find('select').change(showStudentsMessageSentTo).change(checkSendable);\n  $message_students_dialog.find('.cutoff_score').bind('change blur keyup', showStudentsMessageSentTo).bind('change blur keyup', checkSendable);\n  $message_students_dialog.find('#body').bind('change blur keyup', checkSendable);\n});\n\nfunction disableButtons(disabled, buttons) {\n  if (buttons == null) {\n    buttons = messageStudentsDialog().find('button');\n  }\n\n  buttons.toggleClass('disabled', disabled).attr('aria-disabled', disabled);\n}\n\nfunction disableSend(disabled) {\n  disableButtons(disabled, messageStudentsDialog().find('.send_button'));\n}\n\nfunction messageStudentsDialog() {\n  return jquery__WEBPACK_IMPORTED_MODULE_1___default()('#message_students_dialog');\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (messageStudents);\n\n//# sourceURL=webpack:///./ui/shared/message-students-dialog/jquery/message_students.js?");

/***/ }),

/***/ "U0B8":
/*!************************************************************************!*\
  !*** ./ui/features/gradebook/react/shared/MessageStudentsWhoDialog.js ***!
  \************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _canvas_message_students_dialog_jquery_message_students__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/message-students-dialog/jquery/message_students */ \"FtDy\");\n/* harmony import */ var _canvas_grading_messageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @canvas/grading/messageStudentsWhoHelper */ \"g8W+\");\n/*\n * Copyright (C) 2020 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\nconst MessageStudentsWhoDialog = {\n  show({\n    assignment,\n    students\n  }, onClose) {\n    const settings = _canvas_grading_messageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].settings(assignment, students);\n    settings.onClose = onClose;\n    window.messageStudents(settings);\n  }\n\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (MessageStudentsWhoDialog);\n\n//# sourceURL=webpack:///./ui/features/gradebook/react/shared/MessageStudentsWhoDialog.js?");

/***/ }),

/***/ "g8W+":
/*!*******************************************************!*\
  !*** ./ui/shared/grading/messageStudentsWhoHelper.js ***!
  \*******************************************************/
/*! exports provided: hasSubmitted, hasSubmission, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"hasSubmitted\", function() { return hasSubmitted; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"hasSubmission\", function() { return hasSubmission; });\n/* harmony import */ var underscore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! underscore */ \"Y/W1\");\n/* harmony import */ var underscore__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! i18n!gradebooksharedMessageStudentsWhoHelper */ \"y+LT\");\n/*\n * Copyright (C) 2015 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\nfunction hasSubmitted(submission) {\n  if (submission.excused) {\n    return true;\n  } else if (submission.latePolicyStatus) {\n    return submission.latePolicyStatus !== 'missing';\n  }\n\n  return !!(submission.submittedAt || submission.submitted_at);\n}\nfunction hasSubmission(assignment) {\n  const submissionTypes = getSubmissionTypes(assignment);\n  if (submissionTypes.length === 0) return false;\n  return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.some(submissionTypes, submissionType => submissionType !== 'none' && submissionType !== 'on_paper');\n}\n\nfunction getSubmissionTypes(assignment) {\n  return assignment.submissionTypes || assignment.submission_types;\n}\n\nfunction getCourseId(assignment) {\n  return assignment.courseId || assignment.course_id;\n}\n\nconst MessageStudentsWhoHelper = {\n  settings(assignment, students) {\n    return {\n      options: this.options(assignment),\n      title: assignment.name,\n      points_possible: assignment.points_possible,\n      students,\n      context_code: `course_${getCourseId(assignment)}`,\n      callback: this.callbackFn.bind(this),\n      subjectCallback: this.generateSubjectCallbackFn(assignment)\n    };\n  },\n\n  options(assignment) {\n    const options = this.allOptions();\n    const noSubmissions = !this.hasSubmission(assignment);\n    if (noSubmissions) options.splice(0, 1);\n    return options;\n  },\n\n  allOptions() {\n    return [{\n      text: i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t(\"Haven't submitted yet\"),\n      subjectFn: assignment => i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('No submission for %{assignment}', {\n        assignment: assignment.name\n      }),\n      criteriaFn: student => !hasSubmitted(student)\n    }, {\n      text: i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t(\"Haven't been graded\"),\n      subjectFn: assignment => i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('No grade for %{assignment}', {\n        assignment: assignment.name\n      }),\n      criteriaFn: student => !this.exists(student.score)\n    }, {\n      text: i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Scored less than'),\n      cutoff: true,\n      subjectFn: (assignment, cutoff) => i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Scored less than %{cutoff} on %{assignment}', {\n        assignment: assignment.name,\n        cutoff: i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].n(cutoff)\n      }),\n      criteriaFn: (student, cutoff) => this.scoreWithCutoff(student, cutoff) && student.score < cutoff\n    }, {\n      text: i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Scored more than'),\n      cutoff: true,\n      subjectFn: (assignment, cutoff) => i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Scored more than %{cutoff} on %{assignment}', {\n        assignment: assignment.name,\n        cutoff: i18n_gradebooksharedMessageStudentsWhoHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"].n(cutoff)\n      }),\n      criteriaFn: (student, cutoff) => this.scoreWithCutoff(student, cutoff) && student.score > cutoff\n    }];\n  },\n\n  // implement this so it can be stubbed in tests\n  hasSubmission(assignment) {\n    return hasSubmission(assignment);\n  },\n\n  exists(value) {\n    return value != null;\n  },\n\n  scoreWithCutoff(student, cutoff) {\n    return this.exists(student.score) && student.score !== '' && this.exists(cutoff);\n  },\n\n  callbackFn(selected, cutoff, students) {\n    const criteriaFn = this.findOptionByText(selected).criteriaFn;\n\n    const studentsMatchingCriteria = underscore__WEBPACK_IMPORTED_MODULE_0___default.a.filter(students, student => criteriaFn(student.user_data, cutoff));\n\n    return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.map(studentsMatchingCriteria, student => student.user_data.id);\n  },\n\n  findOptionByText(text) {\n    return underscore__WEBPACK_IMPORTED_MODULE_0___default.a.find(this.allOptions(), option => option.text === text);\n  },\n\n  generateSubjectCallbackFn(assignment) {\n    return (selected, cutoff) => {\n      const cutoffString = cutoff || '';\n      const subjectFn = this.findOptionByText(selected).subjectFn;\n      return subjectFn(assignment, cutoffString);\n    };\n  }\n\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (MessageStudentsWhoHelper);\n\n//# sourceURL=webpack:///./ui/shared/grading/messageStudentsWhoHelper.js?");

/***/ }),

/***/ "iDn3":
/*!****************************************************************************************!*\
  !*** ./frontend_build/i18n.js?public_message_students!./ui/shims/dummyI18nResource.js ***!
  \****************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/i18n/i18nObj */ \"HGxv\");\n/* harmony import */ var translations_core_en__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! translations/_core_en */ \"0sPK\");\n\n    \n    \n    \n\n    /* harmony default export */ __webpack_exports__[\"default\"] = (_canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scoped('public_message_students'));\n  \n\n//# sourceURL=webpack:///./ui/shims/dummyI18nResource.js?./frontend_build/i18n.js?public_message_students");

/***/ }),

/***/ "y+LT":
/*!********************************************************************************************************!*\
  !*** ./frontend_build/i18n.js?gradebooksharedMessageStudentsWhoHelper!./ui/shims/dummyI18nResource.js ***!
  \********************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/i18n/i18nObj */ \"HGxv\");\n/* harmony import */ var translations_core_en__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! translations/_core_en */ \"0sPK\");\n\n    \n    \n    \n\n    /* harmony default export */ __webpack_exports__[\"default\"] = (_canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scoped('gradebooksharedMessageStudentsWhoHelper'));\n  \n\n//# sourceURL=webpack:///./ui/shims/dummyI18nResource.js?./frontend_build/i18n.js?gradebooksharedMessageStudentsWhoHelper");

/***/ })

}]);