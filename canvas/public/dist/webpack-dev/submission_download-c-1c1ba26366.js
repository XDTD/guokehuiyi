(window["canvasWebpackJsonp"] = window["canvasWebpackJsonp"] || []).push([["submission_download"],{

/***/ "7hm3":
/*!******************************************!*\
  !*** ./packages/jqueryui/progressbar.js ***!
  \******************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./core */ \"MIhX\");\n/* harmony import */ var _widget__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./widget */ \"dJId\");\n/*!\n * jQuery UI Progressbar @VERSION\n *\n * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)\n * Dual licensed under the MIT or GPL Version 2 licenses.\n * http://jquery.org/license\n *\n * http://docs.jquery.com/UI/Progressbar\n *\n * Depends:\n *   jquery.ui.core.js\n *   jquery.ui.widget.js\n */\n\n\n\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.widget( \"ui.progressbar\", {\n\tversion: \"@VERSION\",\n\toptions: {\n\t\tvalue: 0,\n\t\tmax: 100\n\t},\n\n\tmin: 0,\n\n\t_create: function() {\n\t\tthis.element\n\t\t\t.addClass( \"ui-progressbar ui-widget ui-widget-content ui-corner-all\" )\n\t\t\t.attr({\n\t\t\t\trole: \"progressbar\",\n\t\t\t\t\"aria-valuemin\": this.min,\n\t\t\t\t\"aria-valuemax\": this.options.max,\n\t\t\t\t\"aria-valuenow\": this._value()\n\t\t\t});\n\n\t\tthis.valueDiv = jquery__WEBPACK_IMPORTED_MODULE_0___default()( \"<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>\" )\n\t\t\t.appendTo( this.element );\n\n\t\tthis.oldValue = this._value();\n\t\tthis._refreshValue();\n\t},\n\n\t_destroy: function() {\n\t\tthis.element\n\t\t\t.removeClass( \"ui-progressbar ui-widget ui-widget-content ui-corner-all\" )\n\t\t\t.removeAttr( \"role\" )\n\t\t\t.removeAttr( \"aria-valuemin\" )\n\t\t\t.removeAttr( \"aria-valuemax\" )\n\t\t\t.removeAttr( \"aria-valuenow\" );\n\n\t\tthis.valueDiv.remove();\n\t},\n\n\tvalue: function( newValue ) {\n\t\tif ( newValue === undefined ) {\n\t\t\treturn this._value();\n\t\t}\n\n\t\tthis._setOption( \"value\", newValue );\n\t\treturn this;\n\t},\n\n\t_setOption: function( key, value ) {\n\t\tif ( key === \"value\" ) {\n\t\t\tthis.options.value = value;\n\t\t\tthis._refreshValue();\n\t\t\tif ( this._value() === this.options.max ) {\n\t\t\t\tthis._trigger( \"complete\" );\n\t\t\t}\n\t\t}\n\n\t\tthis._super( key, value );\n\t},\n\n\t_value: function() {\n\t\tvar val = this.options.value;\n\t\t// normalize invalid value\n\t\tif ( typeof val !== \"number\" ) {\n\t\t\tval = 0;\n\t\t}\n\t\treturn Math.min( this.options.max, Math.max( this.min, val ) );\n\t},\n\n\t_percentage: function() {\n\t\treturn 100 * this._value() / this.options.max;\n\t},\n\n\t_refreshValue: function() {\n\t\tvar value = this.value(),\n\t\t\tpercentage = this._percentage();\n\n\t\tif ( this.oldValue !== value ) {\n\t\t\tthis.oldValue = value;\n\t\t\tthis._trigger( \"change\" );\n\t\t}\n\n\t\tthis.valueDiv\n\t\t\t.toggle( value > this.min )\n\t\t\t.toggleClass( \"ui-corner-right\", value === this.options.max )\n\t\t\t.width( percentage.toFixed(0) + \"%\" );\n\t\tthis.element.attr( \"aria-valuenow\", value );\n\t}\n});\n\n\n\n\n//# sourceURL=webpack:///./packages/jqueryui/progressbar.js?");

/***/ }),

/***/ "I74N":
/*!*********************************************************!*\
  !*** ./ui/features/submission_download/jquery/index.js ***!
  \*********************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var browser_sniffer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! browser-sniffer */ \"ik22\");\n/* harmony import */ var i18n_submissions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! i18n!submissions */ \"zakt\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jquery */ \"ouhR\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var html_escape__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! html-escape */ \"gI0r\");\n/* harmony import */ var _canvas_jquery_jquery_ajaxJSON__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @canvas/jquery/jquery.ajaxJSON */ \"dhbk\");\n/* harmony import */ var jqueryui_dialog__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! jqueryui/dialog */ \"ESjL\");\n/* harmony import */ var jqueryui_progressbar__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! jqueryui/progressbar */ \"7hm3\");\n/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n\n\n\n\n\nconst MAX_RETRIES = 3;\n\nbrowser_sniffer__WEBPACK_IMPORTED_MODULE_0__[\"default\"].downloadSubmissions = function (url, onClose) {\n  let retryCount = 0;\n  let cancelled = false;\n  const title = ENV.SUBMISSION_DOWNLOAD_DIALOG_TITLE || i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Download Assignment Submissions');\n  jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog').dialog({\n    title,\n\n    close() {\n      cancelled = true;\n    }\n\n  }).on('dialogclose', onClose);\n  jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .progress').progressbar({\n    value: 0\n  });\n\n  const checkForChange = function () {\n    if (cancelled || jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog:visible').length === 0) {\n      return;\n    }\n\n    jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status_loader').css('visibility', 'visible');\n    let lastProgress = null;\n    jquery__WEBPACK_IMPORTED_MODULE_2___default.a.ajaxJSON(url, 'GET', {}, data => {\n      if (data && data.attachment) {\n        const attachment = data.attachment;\n\n        if (attachment.workflow_state === 'zipped') {\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .progress').progressbar('value', 100);\n          const message = i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('#submissions.finished_redirecting', 'Finished!  Redirecting to File...');\n          const linkText = i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Click here to download %{size_of_file}', {\n            size_of_file: attachment.readable_size\n          });\n          const link = `<a href=\"${Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(url)}\"><b>${Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(linkText)}</b></a>`;\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status').html(`${Object(html_escape__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(message)}<br>${jquery__WEBPACK_IMPORTED_MODULE_2___default.a.raw(link)}`);\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status_loader').css('visibility', 'hidden');\n          location.href = url;\n          return;\n        } else if (attachment.workflow_state === 'errored') {\n          // The only way the backend gets to an \"errored\" state is if there are no files to add\n          // to the zip in the first place...\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .progress').progressbar('value', 100);\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status').text(i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('No submissions to zip. Please try again after student submissions.'));\n          cancelled = true;\n        } else {\n          let progress = parseInt(attachment.file_state, 10);\n\n          if (isNaN(progress)) {\n            progress = 0;\n          }\n\n          progress += 5;\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .progress').progressbar('value', progress);\n          let message = null;\n\n          if (progress >= 95) {\n            message = i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('#submissions.creating_zip', 'Creating zip file...');\n          } else {\n            message = i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('#submissions.gathering_files_progress', 'Gathering Files (%{progress})...', {\n              progress: i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].toPercentage(progress)\n            });\n          }\n\n          jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status').text(message);\n\n          if (progress <= 5 || progress === lastProgress) {\n            jquery__WEBPACK_IMPORTED_MODULE_2___default.a.ajaxJSON(`${url}&compile=1`, 'GET', {}, () => {}, () => {});\n          }\n\n          lastProgress = progress;\n        }\n      }\n\n      jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status_loader').css('visibility', 'hidden');\n      setTimeout(checkForChange, 3000);\n    }, () => {\n      retryCount += 1;\n\n      if (retryCount > MAX_RETRIES) {\n        jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .progress').progressbar('value', 100);\n        jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status').text(i18n_submissions__WEBPACK_IMPORTED_MODULE_1__[\"default\"].t('Something went wrong downloading submissions. Please try again later.'));\n        cancelled = true;\n      }\n\n      jquery__WEBPACK_IMPORTED_MODULE_2___default()('#download_submissions_dialog .status_loader').css('visibility', 'hidden');\n      setTimeout(checkForChange, 1000);\n    });\n  };\n\n  checkForChange();\n};\n\n//# sourceURL=webpack:///./ui/features/submission_download/jquery/index.js?");

/***/ }),

/***/ "cvPG":
/*!**************************************************!*\
  !*** ./ui/features/submission_download/index.js ***!
  \**************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _jquery_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./jquery/index */ \"I74N\");\n/*\n * Copyright (C) 2013 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n//# sourceURL=webpack:///./ui/features/submission_download/index.js?");

/***/ }),

/***/ "zakt":
/*!****************************************************************************!*\
  !*** ./frontend_build/i18n.js?submissions!./ui/shims/dummyI18nResource.js ***!
  \****************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/i18n/i18nObj */ \"HGxv\");\n/* harmony import */ var translations_core_en__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! translations/_core_en */ \"0sPK\");\n\n    \n    \n    \n\n    /* harmony default export */ __webpack_exports__[\"default\"] = (_canvas_i18n_i18nObj__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scoped('submissions'));\n  \n\n//# sourceURL=webpack:///./ui/shims/dummyI18nResource.js?./frontend_build/i18n.js?submissions");

/***/ })

}]);