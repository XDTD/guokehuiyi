var _ = require('underscore');

var build_adder = function(x) {return function(y) {return x + y;};};
var get_slices_a = function(count) {
  var slices = [0];
  var shift = 1;
  while (slices.length < count) {
      shift /= 2;
      var adder = build_adder(shift);
      slices = slices.concat(slices.map(adder));
  }
  slices = slices.slice(0, count);
  return slices;
}
var get_slice_a = function(x) {
  var slices = get_slices_a(x);
  return slices[x-1];
}

var get_slice_b = function(x) {
  var slice = 0;
  var divisor = 2;
  while (x) {
    if (x & 1) {
      slice += 1 / divisor;
    }
    x >>= 1;
    divisor <<= 1;
  }
  return slice;
};
var get_slices_b = function(count) {
  var slices = [];
  for (var i = 0; i < count; i++) {
    slices.push(get_slice_b(i));
  }
  return slices;
};

var start;

start = process.hrtime();
console.log('nothing:');
console.log(process.hrtime(start)[1] / 1000);

start = process.hrtime();
console.log('nothing:');
console.log(process.hrtime(start)[1] / 1000);

console.log('---list---');

start = process.hrtime();
slices_a = get_slices_a(50);
console.log('original:');
console.log(process.hrtime(start)[1] / 1000);

start = process.hrtime();
slices_b = get_slices_b(50);
console.log('new:');
console.log(process.hrtime(start)[1] / 1000);

console.log('---pos---');

start = process.hrtime();
slices_a = get_slice_a(1000);
console.log('original:');
console.log(process.hrtime(start)[1] / 1000);

start = process.hrtime();
slices_b = get_slice_b(1000);
console.log('new:');
console.log(process.hrtime(start)[1] / 1000);

for (var i = 0; i < slices_a.length; i++) {
  if (slices_a[i] == slices_b[i]) {continue;}
  console.log(i);
  console.log(slices_a[i]);
  console.log(slices_b[i]);
  console.log('broken!');
  return;
}
