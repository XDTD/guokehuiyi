"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _chai = require("chai");

var _react = _interopRequireDefault(require("react"));

var _sinon = _interopRequireDefault(require("sinon"));

var _enzyme = require("enzyme");

var _index = _interopRequireDefault(require("../index"));

var _OutcomeViewModal = _interopRequireDefault(require("../../OutcomeViewModal"));

var _OutcomeTree = _interopRequireDefault(require("../../OutcomeTree"));

var _checkA11y = _interopRequireDefault(require("../../../test/checkA11y"));

describe('OutcomePicker', function () {
  function makeProps() {
    var props = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {};
    return Object.assign({
      focusedOutcome: null,
      selectedOutcomes: [{
        id: '2'
      }, {
        id: '3'
      }],
      hasOutcomes: true,
      isOutcomeSelected: _sinon.default.stub().returns(false),
      deselectOutcomeIds: _sinon.default.spy(),
      setFocusedOutcome: _sinon.default.spy(),
      setActiveCollection: _sinon.default.spy(),
      setSearchLoading: _sinon.default.spy(),
      setSearchEntries: _sinon.default.spy(),
      updateSearchText: _sinon.default.spy(),
      updateSearchPage: _sinon.default.spy(),
      searchText: '',
      searchPage: 1,
      searchTotal: 0,
      searchEntries: [],
      treeView: _OutcomeTree.default,
      scope: 'scopeForTest',
      artifactTypeName: '',
      isSearchLoading: false
    }, props);
  }

  it('passes correct params to OutcomeTags component', function () {
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, makeProps()), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find('OutcomeTags').prop('outcomes')).to.deep.equal([{
      id: '2'
    }, {
      id: '3'
    }]);
  });
  it('has a screen reader content for selected outcomes', function () {
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, makeProps()), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find('ScreenReaderContent')).to.have.length(1);
  });
  it('shows an outcome when focused', function () {
    var focusedOutcome = {
      id: 'TEST-1',
      guid: 'GUID',
      label: 'Test outcome',
      title: 'Testing'
    };
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, makeProps({
      focusedOutcome: focusedOutcome
    })), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find(_OutcomeViewModal.default)).to.have.length(1);
  });
  it('calls setFocusedOutcome when closeAlignment is called', function () {
    var focusedOutcome = {
      id: 'TEST-1',
      guid: 'GUID',
      label: 'Test outcome',
      title: 'Testing'
    };
    var props = makeProps({
      focusedOutcome: focusedOutcome
    });
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
      disableLifecycleMethods: true
    });
    wrapper.find(_OutcomeViewModal.default).prop('closeAlignment')();
    (0, _chai.expect)(props.setFocusedOutcome.calledOnce).to.be.true;
  });
  it('shows the proper billboard when there are no outcomes present', function () {
    var props = makeProps({
      hasOutcomes: false
    });
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find('Billboard')).to.have.length(1);
    (0, _chai.expect)(wrapper.find('Billboard').prop('heading')).to.equal('There are no outcomes');
  });
  it('renders search bar', function () {
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, makeProps()), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find('SearchInput')).to.have.length(1);
  });
  it('renders OutcomeTree when no search text is present', function () {
    var props = makeProps();
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
      disableLifecycleMethods: true
    });
    var tree = wrapper.find('OutcomeTree');
    (0, _chai.expect)(tree).to.have.length(1);
    (0, _chai.expect)(tree.prop('scope')).to.equal(props.scope);
  });
  it('shows only search results when searchText is present', function () {
    var props = makeProps({
      searchText: 'out'
    });
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find('SearchResults')).to.have.length(1);
    (0, _chai.expect)(wrapper.find('OutcomeTree')).to.have.length(0);
  });
  it('resets focus on update', function () {
    var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, makeProps()));
    wrapper.setProps((0, _objectSpread2.default)({}, makeProps({
      activeCollection: {
        id: '101'
      }
    })));
    (0, _chai.expect)(wrapper.getDOMNode().contains(document.activeElement));
  });
  it('meets a11y standards', function () {
    return (0, _checkA11y.default)(_react.default.createElement(_index.default, makeProps()));
  });
  it('correctly calls updateSearchText when search text is changed', function () {
    var props = makeProps();
    var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props));
    var onChange = wrapper.find('TextInput').prop('onChange');
    onChange('', 'abc');
    (0, _chai.expect)(props.updateSearchText).to.be.called.once;
    (0, _chai.expect)(props.updateSearchText).to.be.calledWith('abc');
  });
});