"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _chai = require("chai");

var _react = _interopRequireDefault(require("react"));

var _enzyme = require("enzyme");

var _sinon = _interopRequireDefault(require("sinon"));

var _index = _interopRequireDefault(require("../index"));

var _checkA11y = _interopRequireDefault(require("../../../test/checkA11y"));

describe('SearchResults', function () {
  function makeProps() {
    var props = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {};
    return Object.assign({
      searchText: 'foo',
      searchPage: 1,
      searchTotal: 99,
      searchOutcomes: _sinon.default.spy(),
      setSearchLoading: _sinon.default.spy(),
      setSearchEntries: _sinon.default.spy(),
      updateSearchPage: _sinon.default.stub(),
      isSearchLoading: true,
      searchEntries: [],
      setActiveCollection: _sinon.default.spy(),
      toggleExpandedIds: _sinon.default.stub(),
      setFocusedOutcome: _sinon.default.spy(),
      isOutcomeSelected: _sinon.default.spy(),
      selectOutcomeIds: _sinon.default.spy(),
      deselectOutcomeIds: _sinon.default.spy(),
      screenreaderNotification: _sinon.default.stub()
    }, props);
  }

  it('renders Spinner when loading', function () {
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, makeProps()), {
      disableLifecycleMethods: true
    });
    (0, _chai.expect)(wrapper.find('Spinner')).to.have.length(1);
  });
  it('passes correct params to OutcomeCheckbox components', function () {
    var props = makeProps();
    props.isSearchLoading = false;
    props.searchEntries = [{
      id: '2',
      label: 'abc',
      title: '123'
    }];
    var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
      disableLifecycleMethods: true
    });
    var checkbox = wrapper.find('OutcomeCheckbox');
    (0, _chai.expect)(checkbox).to.have.length(1);
    (0, _chai.expect)(checkbox.prop('outcome')).to.eql({
      id: '2',
      label: 'abc',
      title: '123'
    });
  });
  describe('returns the correct result count', function () {
    describe('with zero results', function () {
      it('returns a properly formatted string', function () {
        var props = makeProps({
          searchTotal: 0,
          isSearchLoading: false
        });
        var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
          disableLifecycleMethods: true
        });
        (0, _chai.expect)(wrapper.find('Text').prop('children')).to.equal('The search returned no results');
      });
    });
    describe('with one result', function () {
      it('returns a properly formatted string', function () {
        var props = makeProps({
          searchTotal: 1,
          isSearchLoading: false
        });
        var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
          disableLifecycleMethods: true
        });
        (0, _chai.expect)(wrapper.find('Text').prop('children')).to.equal('1 result');
      });
    });
    describe('with more than one result', function () {
      it('returns a properly formatted string', function () {
        var props = makeProps({
          searchTotal: 2,
          isSearchLoading: false
        });
        var wrapper = (0, _enzyme.shallow)(_react.default.createElement(_index.default, props), {
          disableLifecycleMethods: true
        });
        (0, _chai.expect)(wrapper.find('Text').prop('children')).to.equal('2 results');
      });
    });
  });
  describe('pagination', function () {
    var searchEntries = [{
      id: '1'
    }, {
      id: '2'
    }];
    it('does not include pagination for 0 results', function () {
      var props = makeProps({
        searchEntries: searchEntries,
        searchTotal: 0,
        isSearchLoading: false
      });
      var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props), {
        disableLifecycleMethods: true
      });
      var nextPageButton = wrapper.find('button').findWhere(function (z) {
        return z.text() == 'Next Page';
      });
      (0, _chai.expect)(nextPageButton).to.have.length(0);
    });
    it('does not include pagination for < 10 results', function () {
      var props = makeProps({
        searchEntries: searchEntries,
        searchTotal: 0,
        isSearchLoading: false
      });
      var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props), {
        disableLifecycleMethods: true
      });
      var nextPageButton = wrapper.find('button').findWhere(function (z) {
        return z.text() == 'Next Page';
      });
      (0, _chai.expect)(nextPageButton).to.have.length(0);
    });
    it('does include pagination for > 10 results', function () {
      var props = makeProps({
        searchEntries: searchEntries,
        searchTotal: 999,
        isSearchLoading: false
      });
      var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props), {
        disableLifecycleMethods: true
      });
      var nextPageButton = wrapper.find('button').findWhere(function (z) {
        return z.text() == 'Next Page';
      });
      (0, _chai.expect)(nextPageButton).not.to.have.length(0);
    });
    it('shows the current page', function () {
      var props = makeProps({
        searchEntries: searchEntries,
        searchPage: 25,
        searchTotal: 999,
        isSearchLoading: false
      });
      var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props), {
        disableLifecycleMethods: true
      });
      var currentPageButton = wrapper.find('button').findWhere(function (z) {
        return z.text() == '25';
      });
      (0, _chai.expect)(currentPageButton).not.to.have.length(0);
    });
    it('updates the current page when pagination button is clicked', function () {
      var props = makeProps({
        searchEntries: searchEntries,
        isSearchLoading: false
      });
      var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props), {
        disableLifecycleMethods: true
      });
      var pageTwoButton = wrapper.find('button').findWhere(function (z) {
        return z.text() == '2';
      });
      pageTwoButton.first().simulate('click');
      (0, _chai.expect)(props.updateSearchPage).to.have.been.calledWith(2);
    });
  });
  describe('screenreaderNotification', function () {
    it('calls the screenreaderNotification when the search loading is complete', function () {
      var props = makeProps({
        isSearchLoading: true
      });
      var wrapper = (0, _enzyme.mount)(_react.default.createElement(_index.default, props));
      (0, _chai.expect)(props.screenreaderNotification).not.to.have.been.called;
      wrapper.setProps({
        isSearchLoading: false
      });
      (0, _chai.expect)(props.screenreaderNotification).to.have.been.called;
    });
  });
  it('meets a11y standards', function () {
    return (0, _checkA11y.default)(_react.default.createElement(_index.default, makeProps()));
  });
});