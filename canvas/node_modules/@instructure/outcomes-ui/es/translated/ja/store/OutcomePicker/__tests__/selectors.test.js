import { expect } from 'chai';
import { Map, List, fromJS } from 'immutable';
import { getSelectedOutcomeIds, makeIsOutcomeSelected, anyOutcomeSelected, getActiveCollection, getActiveChildren, getOutcomePickerState, getExpandedIds } from '../selectors';
describe('OutcomePicker/selectors', function () {
  var scope = 'scopeForTest';
  var state = fromJS({
    scopeForTest: {
      config: {
        contextUuid: 'course_100'
      },
      OutcomePicker: {
        selected: ['1', '2', '3'],
        state: 'testing',
        expandedIds: ['1'],
        scope: scope
      }
    },
    context: {
      outcomes: {
        course_100: {
          1: {
            id: 1,
            title: 'Some outcome 1',
            description: 'Description 1',
            child_ids: ['2', '3']
          },
          2: {
            id: 2,
            title: 'Some outcome 2',
            description: 'Description 2',
            child_ids: ['4']
          },
          3: {
            id: 3,
            title: 'Some outcome 3',
            description: 'Description 3',
            child_ids: []
          },
          4: {
            id: 4,
            title: 'Some outcome 4',
            description: 'Description 4'
          }
        }
      }
    }
  });
  describe('getSelectedOutcomeIds', function () {
    it('retrieves the correct ids', function () {
      expect(getSelectedOutcomeIds(state, scope)).to.deep.equal(['1', '2', '3']);
    });
    it('returns an empty array if no outcomes are selected', function () {
      var newState = Map();
      expect(getSelectedOutcomeIds(newState, scope)).to.deep.equal([]);
    });
  });
  describe('makeIsOutcomeSelected', function () {
    it('returns true if outcome id is selected', function () {
      expect(makeIsOutcomeSelected(state, scope)('2')).to.be.true;
    });
    it('returns false if outcome is not selected', function () {
      expect(makeIsOutcomeSelected(state, scope)('4')).to.be.false;
    });
    it('returns false if no outcomes are selected', function () {
      var newState = Map();
      expect(makeIsOutcomeSelected(newState, scope)('1')).to.be.false;
    });
  });
  describe('anyOutcomeSelected', function () {
    it('returns true when outcomes are selected', function () {
      expect(anyOutcomeSelected(state, scope)).to.be.true;
    });
    it('returns false if empty selected outcomes', function () {
      var newState = state.setIn([scope, 'OutcomePicker', 'selected'], new List());
      expect(anyOutcomeSelected(newState, scope)).to.be.false;
    });
    it('returns false if no selected outcomes', function () {
      var newState = Map();
      expect(anyOutcomeSelected(newState)).to.be.false;
    });
  });
  describe('getActiveCollection', function () {
    it('returns correct values if there is no active collection', function () {
      var data = getActiveCollection(state, scope);
      expect(data.id).to.equal('');
      expect(data.header).to.equal('');
      expect(data.summary).to.equal('');
      expect(data.description).to.equal('');
    });
    it('returns the correct values if id if present', function () {
      var newState = state.setIn([scope, 'OutcomePicker', 'activeCollection'], '1');
      var data = getActiveCollection(newState, scope);
      expect(data.id).to.equal(1);
      expect(data.header).to.equal('Some outcome 1');
      expect(data.summary).to.equal('1 Group | 1 Outcome');
      expect(data.description).to.equal('Description 1');
    });
  });
  describe('getActiveChildren', function () {
    it('returns an empty map when no set active', function () {
      expect(getActiveChildren(state, scope)).to.deep.equal({
        groups: [],
        nonGroups: []
      });
    });
    it('returns the list of groups and non groups when present', function () {
      var newState = state.setIn([scope, 'OutcomePicker', 'activeCollection'], '1');

      var _getActiveChildren = getActiveChildren(newState, scope),
          groups = _getActiveChildren.groups,
          nonGroups = _getActiveChildren.nonGroups;

      expect(groups).to.deep.equal([{
        id: 2,
        title: 'Some outcome 2',
        description: 'Description 2',
        child_ids: ['4']
      }]);
      expect(nonGroups).to.deep.equal([{
        id: 3,
        title: 'Some outcome 3',
        description: 'Description 3',
        child_ids: []
      }]);
    });
    it('returns an empty map when no child ids are present', function () {
      var newState = state.setIn([scope, 'OutcomePicker', 'activeCollection'], '4');
      expect(getActiveChildren(newState, scope)).to.deep.equal({
        groups: [],
        nonGroups: []
      });
    });
  });
  describe('getOutcomePickerState', function () {
    it('retrieves the correct value', function () {
      expect(getOutcomePickerState(state, scope)).to.equal('testing');
    });
  });
  describe('getExpandedIds', function () {
    it('retrieves the correct value', function () {
      expect(getExpandedIds(state, scope)).to.deep.equal(['1']);
    });
  });
});