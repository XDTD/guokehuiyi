import _objectSpread from "@babel/runtime/helpers/esm/objectSpread2";
import { expect } from 'chai';
import React from 'react';
import sinon from 'sinon';
import { shallow, mount } from 'enzyme';
import OutcomeTree from '../index';
var styles = {
  componentId: 'bkdMu',
  template: function template(theme) {
    return "\n\n.outcomes-ui__OutcomeTree--outcomeTree {\n  overflow: scroll;\n  height: 100%;\n}\n\n.outcomes-ui__OutcomeTree--outcomeContent {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow-y: scroll;\n}\n\n.outcomes-ui__OutcomeTree--selectedOutcomeCollection {\n  padding-bottom: 1rem;\n  padding-left: 1rem;\n  padding-top: 1rem;\n}\n\n.outcomes-ui__OutcomeTree--selectedOutcomeCollection .outcomes-ui__OutcomeTree--outcomeDescription > p {\n  margin-top: 0.75rem;\n  margin-bottom: 0.75rem;\n}\n\n.outcomes-ui__OutcomeTree--selectedOutcomeCollection .outcomes-ui__OutcomeTree--outcomeDescription > p:last-child {\n    margin-bottom: 0\n  }\n";
  },
  'outcomeTree': 'outcomes-ui__OutcomeTree--outcomeTree',
  'outcomeContent': 'outcomes-ui__OutcomeTree--outcomeContent',
  'selectedOutcomeCollection': 'outcomes-ui__OutcomeTree--selectedOutcomeCollection',
  'outcomeDescription': 'outcomes-ui__OutcomeTree--outcomeDescription'
};
import checkA11y from '../../../test/checkA11y';
describe('OutcomeTree', function () {
  var outcomeData = {
    label: 'FOO',
    title: 'bar'
  };
  var groups = [_objectSpread({
    'id': '2'
  }, outcomeData), _objectSpread({
    'id': '3'
  }, outcomeData), _objectSpread({
    'id': '6'
  }, outcomeData)];
  var nonGroups = [_objectSpread({
    'id': '4'
  }, outcomeData), _objectSpread({
    'id': '5'
  }, outcomeData)];

  function makeProps() {
    var props = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {};
    return Object.assign({
      activeChildren: {
        groups: groups,
        nonGroups: nonGroups
      },
      rootOutcomeIds: [],
      toggleExpandedIds: sinon.spy(),
      isOutcomeSelected: sinon.stub().returns(false),
      getOutcomeSummary: sinon.spy(),
      selectOutcomeIds: sinon.spy(),
      deselectOutcomeIds: sinon.spy(),
      setFocusedOutcome: sinon.spy(),
      setActiveCollection: sinon.spy(),
      collections: {
        100: {
          id: '100',
          name: 'Outcome group'
        }
      },
      expandedIds: [],
      activeCollection: {
        id: '100',
        header: 'Outcome group',
        summary: '1 outcome',
        description: 'This is the description'
      }
    }, props);
  }

  it('passes the correct params to OutcomeBrowser', function () {
    var props = makeProps();
    var wrapper = shallow(React.createElement(OutcomeTree, props), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('OutcomeBrowser')).to.have.length(1);
    expect(wrapper.find('OutcomeBrowser').prop('collections')).to.deep.equal(props.collections);
    expect(wrapper.find('OutcomeBrowser').prop('rootOutcomeIds')).to.deep.equal(props.rootOutcomeIds);
    expect(wrapper.find('OutcomeBrowser').prop('expandedIds')).to.deep.equal(props.expandedIds);
  });
  it('wraps the browser with the proper CSS styling', function () {
    var wrapper = shallow(React.createElement(OutcomeTree, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find(".".concat(styles.outcomeTree)).exists()).to.equal(true);
  });
  it('passes correct params to OutcomeSelectionList component', function () {
    var wrapper = shallow(React.createElement(OutcomeTree, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('OutcomeSelectionList').prop('outcomes')).to.deep.equal(nonGroups);
  });
  it('passes correct params to OutcomeFolderList component', function () {
    var props = makeProps();
    var wrapper = shallow(React.createElement(OutcomeTree, props), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('OutcomeFolderList').prop('outcomes')).to.deep.equal(groups);
    expect(wrapper.find('OutcomeFolderList').prop('activeCollectionId')).to.deep.equal(props.activeCollection.id);
  });
  it('passes correct params to the Text components', function () {
    var wrapper = shallow(React.createElement(OutcomeTree, makeProps()), {
      disableLifecycleMethods: true
    });
    var texts = wrapper.find('Text');
    var header = wrapper.find('Heading');
    expect(texts.at(0).render().text()).to.equal('1 outcome');
    expect(texts.at(1).render().text()).to.equal('This is the description');
    expect(header.at(0).render().text()).to.equal('Outcome group');
  });
  it('sanitizes the outcome description', function () {
    var props = makeProps();
    props.activeCollection.description = 'I have <blink>invalid html';
    var wrapper = mount(React.createElement(OutcomeTree, props));
    expect(wrapper.html()).to.include('</blink>');
  });
  it('sets the CSS styling when there is a description', function () {
    var wrapper = shallow(React.createElement(OutcomeTree, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find(".".concat(styles.outcomeDescription)).exists()).to.equal(true);
  });
  it('shows the proper billboard when there are no active collection details', function () {
    var props = makeProps({
      activeCollection: {}
    });
    var wrapper = shallow(React.createElement(OutcomeTree, props), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('Billboard')).to.have.length(1);
    expect(wrapper.find('Billboard').prop('heading')).to.equal('Align Outcomes');
  });
  it('shows the proper billboard when there is no active collection id', function () {
    var props = makeProps();
    delete props.activeCollection.id;
    var wrapper = shallow(React.createElement(OutcomeTree, props), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('Billboard')).to.have.length(1);
    expect(wrapper.find('Billboard').prop('heading')).to.equal('Align Outcomes');
  });
  it('does not set the CSS description styling when there are no active collection details', function () {
    var props = makeProps({
      activeCollection: {}
    });
    var wrapper = shallow(React.createElement(OutcomeTree, props), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find(".".concat(styles.outcomeDescription)).exists()).to.equal(false);
  });
  it('sets the CSS content styling', function () {
    var props = makeProps({
      activeCollection: {}
    });
    var wrapper = shallow(React.createElement(OutcomeTree, props), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find(".".concat(styles.outcomeContent)).exists()).to.equal(true);
  });
  it('handles missing activeCollection props', function () {
    var props = makeProps();
    delete props.activeCollection;
    var wrapper = mount(React.createElement(OutcomeTree, props));
    var texts = wrapper.find('Text');
    expect(texts.at(0).render().text()).to.equal('Select all');
  });
  it('meets a11y standards', function () {
    var props = makeProps();
    return checkA11y(React.createElement(OutcomeTree, props));
  });
  it('resets focus on update', function () {
    var wrapper = mount(React.createElement(OutcomeTree, makeProps()));
    wrapper.setProps(_objectSpread({}, makeProps({
      activeCollection: {
        id: '101'
      }
    })));
    expect(wrapper.getDOMNode().contains(document.activeElement));
  });
});