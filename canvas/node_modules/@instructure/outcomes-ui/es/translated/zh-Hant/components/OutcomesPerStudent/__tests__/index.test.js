import chai, { expect } from 'chai';
import React from 'react';
import sinon from 'sinon';
import { shallow } from 'enzyme';
import OutcomesPerStudent from '../index';
import checkA11y from '../../../test/checkA11y';
var styles = {
  componentId: 'eWGXc',
  template: function template(theme) {
    return "\n\n.outcomes-ui__OutcomesPerStudent--reportWrapper {\n  position: relative;\n  padding-left: 13rem;\n}\n\n.outcomes-ui__OutcomesPerStudent--background {\n  background-color: white;\n}\n\n.outcomes-ui__OutcomesPerStudent--table {\n  overflow-x: scroll;\n}\n\n.outcomes-ui__OutcomesPerStudent--headerRow {\n  display: flex;\n  align-items: stretch;\n}\n\n.outcomes-ui__OutcomesPerStudent--corner {\n  position: absolute;\n  box-sizing: border-box;\n  width: 13rem;\n  left: 0;\n  top: auto;\n  font-size: 3rem;\n  font-weight: normal;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.outcomes-ui__OutcomesPerStudent--headerCell, .outcomes-ui__OutcomesPerStudent--corner {\n  box-sizing: border-box;\n  height: 5.5rem;\n  border-right: ".concat(theme.reportBorder || 'inherit', ";\n  border-bottom: ").concat(theme.reportBorder || 'inherit', ";\n}\n\n.outcomes-ui__OutcomesPerStudent--headerCell {\n  box-sizing: border-box;\n  border-top: ").concat(theme.reportBorder || 'inherit', ";\n  padding: 0.5rem;\n  flex: 1 0 10rem;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.outcomes-ui__OutcomesPerStudent--loadingSpinner {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  padding: 1.25rem 0.3125rem 1.25rem 0;\n}\n\n.outcomes-ui__OutcomesPerStudent--studentRow {\n  box-sizing: border-box;\n  height: 4rem;\n  display: flex;\n  align-items: stretch;\n}\n\n.outcomes-ui__OutcomesPerStudent--studentName {\n  position: absolute;\n  box-sizing: border-box;\n  left: 0;\n  top: auto;\n  width: 13rem;\n  height: 4rem;\n  padding-left: 0.5rem;\n  border-right: ").concat(theme.reportBorder || 'inherit', ";\n  display: flex;\n  justify-content: flex-start;\n  border-bottom: ").concat(theme.reportBorder || 'inherit', ";\n  align-items: center;\n}\n\n.outcomes-ui__OutcomesPerStudent--studentName .outcomes-ui__OutcomesPerStudent--avatar {\n    padding-right: .5rem;\n  }\n\n.outcomes-ui__OutcomesPerStudent--studentName .outcomes-ui__OutcomesPerStudent--name {\n    text-align: left;\n    text-overflow: ellipsis;\n    overflow-x: hidden;\n    white-space: nowrap;\n  }\n\n[dir=\"ltr\"] .outcomes-ui__OutcomesPerStudent--studentName .outcomes-ui__OutcomesPerStudent--name {\n    text-align: left;\n  }\n\n[dir=\"rtl\"] .outcomes-ui__OutcomesPerStudent--studentName .outcomes-ui__OutcomesPerStudent--name {\n    text-align: left;\n  }\n\n.outcomes-ui__OutcomesPerStudent--scoreCell {\n  box-sizing: border-box;\n  flex: 1 0 10rem;\n  border-bottom: ").concat(theme.reportBorder || 'inherit', ";\n}\n");
  },
  'reportWrapper': 'outcomes-ui__OutcomesPerStudent--reportWrapper',
  'background': 'outcomes-ui__OutcomesPerStudent--background',
  'table': 'outcomes-ui__OutcomesPerStudent--table',
  'headerRow': 'outcomes-ui__OutcomesPerStudent--headerRow',
  'corner': 'outcomes-ui__OutcomesPerStudent--corner',
  'headerCell': 'outcomes-ui__OutcomesPerStudent--headerCell',
  'loadingSpinner': 'outcomes-ui__OutcomesPerStudent--loadingSpinner',
  'studentRow': 'outcomes-ui__OutcomesPerStudent--studentRow',
  'studentName': 'outcomes-ui__OutcomesPerStudent--studentName',
  'avatar': 'outcomes-ui__OutcomesPerStudent--avatar',
  'name': 'outcomes-ui__OutcomesPerStudent--name',
  'scoreCell': 'outcomes-ui__OutcomesPerStudent--scoreCell'
};
chai.use(require('sinon-chai'));
describe('OutcomesPerStudent/index', function () {
  function makeProps() {
    var props = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {};
    return Object.assign({
      loadPage: sinon.stub().returns(Promise.resolve()),
      getReportOutcome: sinon.stub().returns({
        id: 1,
        label: 'Foo.PRQ.2',
        title: 'Learn stuff'
      }),
      getScore: sinon.spy(),
      setError: sinon.spy(),
      isOpen: sinon.stub().returns(false),
      viewReportAlignment: sinon.spy(),
      closeReportAlignment: sinon.spy(),
      artifactType: 'foo',
      artifactId: 'bar',
      hasAnyOutcomes: true,
      currentPage: 3,
      pageCount: 5,
      rollups: [{
        outcomeId: 101,
        count: 100,
        mastery_count: 11,
        alignedItems: 1
      }, {
        outcomeId: 202,
        alignedItems: 5,
        mastery_count: 19,
        count: 20
      }, {
        outcomeId: 303,
        mastery_count: 12,
        count: 20
      }],
      users: [{
        uuid: 1,
        full_name: 'Darius Jackson'
      }, {
        uuid: 2,
        full_name: 'Penelope Cooper'
      }, {
        uuid: 3,
        full_name: 'Gerry Gergich'
      }, {
        uuid: 4,
        full_name: 'Slim Pickens'
      }, {
        uuid: 5,
        full_name: 'Sir Darryl Roundtree'
      }]
    }, props);
  }

  it('renders a header for each outcome', function () {
    var wrapper = shallow(React.createElement(OutcomesPerStudent, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('Header')).to.have.length(3);
  });
  it('generates the correct viewReportAlignment method for each header', function () {
    var props = makeProps();
    var wrapper = shallow(React.createElement(OutcomesPerStudent, props), {
      disableLifecycleMethods: true
    });
    var header = wrapper.find('Header').last();
    var viewReportAlignment = header.prop('viewReportAlignment');
    viewReportAlignment();
    expect(props.viewReportAlignment).to.have.been.calledOnce;
    expect(props.viewReportAlignment).to.have.been.calledWith(303);
  });
  it('renders a row for each student', function () {
    var wrapper = shallow(React.createElement(OutcomesPerStudent, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find(".".concat(styles.studentRow))).to.have.length(5);
  });
  it('renders a score for each student score', function () {
    var wrapper = shallow(React.createElement(OutcomesPerStudent, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('Score')).to.have.length(15);
  });
  it('renders pagination', function () {
    var wrapper = shallow(React.createElement(OutcomesPerStudent, makeProps()), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('PaginationButton')).to.have.length(5);
  });
  it('renders the billboard message if no results yet exist', function () {
    var wrapper = shallow(React.createElement(OutcomesPerStudent, makeProps({
      users: [],
      hasAnyOutcomes: true
    })), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('Billboard')).to.have.length(1);
    expect(wrapper.find('Billboard').prop('heading')).to.equal('Looks like you\'re a little early');
  });
  it('renders the billboard message if no outcomes are aligned', function () {
    var wrapper = shallow(React.createElement(OutcomesPerStudent, makeProps({
      users: [],
      hasAnyOutcomes: false
    })), {
      disableLifecycleMethods: true
    });
    expect(wrapper.find('Billboard').prop('heading')).to.equal('There is no report here to show');
  });
  it('meets a11y standards', function () {
    return checkA11y(React.createElement(OutcomesPerStudent, makeProps()));
  });
});