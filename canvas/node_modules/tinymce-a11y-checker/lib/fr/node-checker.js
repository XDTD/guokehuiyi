"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = checkNode;

var dom = _interopRequireWildcard(require("./utils/dom"));

var _rules = _interopRequireDefault(require("./rules"));

function checkNode(node, done, config = {}, additionalRules = []) {
  if (!node) {
    return;
  }

  const errors = [];

  const childNodeCheck = child => {
    const composedRules = _rules.default.concat(additionalRules);

    for (let rule of composedRules) {
      if (child.hasAttribute("data-ignore-a11y-check")) {
        continue;
      }

      const promise = Promise.resolve(rule.test(child, config)).then(result => {
        if (!result) {
          errors.push({
            node: child,
            rule
          });
        }
      });
    }
  };

  const checkDone = () => {
    if (typeof done === "function") {
      done(errors);
    }
  };

  dom.walk(node, childNodeCheck, checkDone);
}