'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function () {
  var requireIncludeVisitor = {
    CallExpression: function CallExpression(nodePath) {
      if (isRequireIncludeCallExpression(nodePath)) {
        nodePath.remove();
      }
    }
  };

  return {
    visitor: {
      CallExpression: {
        enter: function enter(nodePath) {
          if (isRequireEnsureCallExpression(nodePath)) {
            nodePath.replaceWith(nodePath.get('arguments')[1].get('body'));
            nodePath.traverse(requireIncludeVisitor);
          }
        }
      }
    }
  };
};

// make sure require.ensure([], () => {});
function isRequireEnsureCallExpression(nodePath) {
  var callee = nodePath.get('callee');
  return callee.isMemberExpression() && callee.get('property').equals('name', 'ensure') && callee.get('object').equals('name', 'require') && nodePath.get('arguments')[0].isArrayExpression() && (nodePath.get('arguments')[1].isFunctionExpression() || nodePath.get('arguments')[1].isArrowFunctionExpression());
}

// make sure require.include('')
function isRequireIncludeCallExpression(nodePath) {
  var callee = nodePath.get('callee');
  return callee.isMemberExpression() && callee.get('property').equals('name', 'include') && callee.get('object').equals('name', 'require');
}